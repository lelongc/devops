# Week 4: File Permissions & Ownership

## ðŸŽ¯ Má»¥c tiÃªu há»c táº­p

Sau khi hoÃ n thÃ nh Week 4, báº¡n sáº½:

- Hiá»ƒu rÃµ há»‡ thá»‘ng permissions Linux (rwx)
- ThÃ nh tháº¡o chmod, chown, chgrp commands
- Náº¯m vá»¯ng octal notation vÃ  symbolic notation
- Hiá»ƒu Special permissions (SUID, SGID, sticky bit)
- Quáº£n lÃ½ umask vÃ  default permissions
- Sá»­ dá»¥ng Access Control Lists (ACL)
- LÃ m viá»‡c vá»›i file attributes

## ðŸ” **Search Keywords Ä‘á»ƒ há»c - Kiáº¿n thá»©c chi tiáº¿t:**

### 1. âœ… "Linux file permissions explained rwx"

#### Linux Permission System Overview:

**Permission Types:**

```
r (Read) = 4     # View file contents or list directory
w (Write) = 2    # Modify file or add/remove files in directory
x (Execute) = 1  # Run file as program or enter directory
```

**Permission Groups:**

```
User (Owner)     # Person who owns the file
Group           # Group that owns the file
Other (World)   # Everyone else
```

#### Permission Display Format:

```bash
ls -l filename
-rwxr-xr--  1 user group 1024 Jan 15 10:30 filename
â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚
â”‚â”‚â”‚â”‚â”‚â”‚â”‚â””â”€ Other permissions (r--)
â”‚â”‚â”‚â”‚â”‚â”‚â””â”€â”€ Group permissions (r-x)
â”‚â”‚â”‚â”‚â”‚â””â”€â”€â”€ User permissions (rwx)
â”‚â”‚â”‚â”‚â””â”€â”€â”€â”€ Number of hard links
â”‚â”‚â”‚â””â”€â”€â”€â”€â”€ File type (-=regular, d=directory, l=link)
â”‚â”‚â””â”€â”€â”€â”€â”€â”€ Special permissions
â”‚â””â”€â”€â”€â”€â”€â”€â”€ (part of file type)
â””â”€â”€â”€â”€â”€â”€â”€â”€ File type indicator
```

#### Permission Meanings by File Type:

**Regular Files:**

```bash
r (Read)     # View file contents: cat, less, head, tail
w (Write)    # Modify file: edit, append, truncate
x (Execute)  # Run as program: ./script.sh, /bin/program

Examples:
-rw-r--r--  # Read/write for owner, read for group/others
-rwxr-xr-x  # Executable for owner, read/execute for group/others
-rw-------  # Read/write for owner only (private file)
```

**Directories:**

```bash
r (Read)     # List directory contents: ls
w (Write)    # Create/delete files in directory
x (Execute)  # Enter directory: cd, access files inside

Examples:
drwxr-xr-x  # Full access for owner, read/execute for others
drwx------  # Private directory, owner only
drwxrwxr-x  # Shared directory, group can modify
```

#### Permission Examples:

```bash
# File permission scenarios:
-rw-r--r--  # Document file (644)
-rwxr-xr-x  # Script file (755)
-rw-------  # Private file (600)
-rwx------  # Private script (700)

# Directory permission scenarios:
drwxr-xr-x  # Public directory (755)
drwxrwx---  # Group collaboration directory (770)
drwx------  # Private directory (700)
```

**ðŸ“– Learn More:**

- [Linux File Permissions Tutorial](https://www.guru99.com/file-permissions.html)
- [Understanding Linux Permissions](https://www.redhat.com/sysadmin/linux-file-permissions-explained)

### 2. âœ… "chmod command tutorial octal notation"

#### Octal (Numeric) Notation:

**Octal Calculation:**

```bash
# Each permission group uses 3 bits:
r (Read)    = 4 (binary: 100)
w (Write)   = 2 (binary: 010)
x (Execute) = 1 (binary: 001)

# Add values for combination:
rwx = 4+2+1 = 7
rw- = 4+2+0 = 6
r-x = 4+0+1 = 5
r-- = 4+0+0 = 4
-wx = 0+2+1 = 3
-w- = 0+2+0 = 2
--x = 0+0+1 = 1
--- = 0+0+0 = 0
```

**Common Octal Permissions:**

```bash
# Files:
644  # rw-r--r--  # Standard file (owner: rw, group/others: r)
600  # rw-------  # Private file (owner only)
755  # rwxr-xr-x  # Executable (owner: rwx, group/others: rx)
700  # rwx------  # Private executable
444  # r--r--r--  # Read-only file

# Directories:
755  # rwxr-xr-x  # Standard directory
750  # rwxr-x---  # Group accessible directory
700  # rwx------  # Private directory
777  # rwxrwxrwx  # World writable (dangerous!)
```

#### chmod Command Examples:

**Octal Notation:**

```bash
# Basic syntax: chmod [permissions] [file/directory]
chmod 644 file.txt        # rw-r--r--
chmod 755 script.sh       # rwxr-xr-x
chmod 600 private.txt     # rw-------
chmod 700 private_dir/    # rwx------

# Multiple files:
chmod 644 *.txt           # Set permissions for all .txt files
chmod 755 /usr/local/bin/script  # Set script permissions

# Recursive:
chmod -R 755 /var/www/    # Set permissions recursively
chmod -R 644 documents/   # Set file permissions in directory
```

**Symbolic Notation:**

```bash
# Syntax: chmod [who][operator][permissions] file
# who: u(user), g(group), o(others), a(all)
# operator: +(add), -(remove), =(set exactly)
# permissions: r(read), w(write), x(execute)

chmod u+x script.sh       # Add execute for user
chmod g-w file.txt        # Remove write for group
chmod o=r file.txt        # Set others to read-only
chmod a+r file.txt        # Add read for all
chmod ug+rw file.txt      # Add read/write for user and group

# Complex examples:
chmod u=rwx,g=rx,o=r file.txt     # Set exact permissions
chmod u+x,g-w,o-r script.sh       # Multiple operations
chmod a=r,u+w document.txt        # All read, user also write
```

**Advanced chmod Usage:**

```bash
# Preserve existing permissions while adding:
chmod +x file.sh          # Add execute for all who have read
chmod +w file.txt         # Add write for all who have read

# Conditional permissions:
chmod u+x *.sh            # Make all shell scripts executable for user
find . -name "*.sh" -exec chmod +x {} \;  # Find and make executable

# Copy permissions from another file:
chmod --reference=file1 file2   # Copy file1's permissions to file2
```

**ðŸ“– Deep Learning:**

- [chmod Command Tutorial](https://www.computerhope.com/unix/uchmod.htm)
- [Linux chmod Calculator](https://chmod-calculator.com/)
- [Advanced chmod Examples](https://www.tecmint.com/chmod-command-examples/)

### 3. âœ… "chown chgrp command examples"

#### File Ownership Concepts:

**Ownership Types:**

```bash
# Every file has two owners:
User Owner   # Individual user who owns the file
Group Owner  # Group that owns the file

# View ownership:
ls -l filename
-rw-r--r-- 1 john developers 1024 Jan 15 10:30 filename
           â”‚ â”‚    â”‚
           â”‚ â”‚    â””â”€â”€ Group owner
           â”‚ â””â”€â”€â”€â”€â”€â”€â”€ User owner
           â””â”€â”€â”€â”€â”€â”€â”€â”€ Link count
```

#### chown Command (Change Owner):

**Basic Syntax:**

```bash
# Change user owner only:
chown username filename
chown john file.txt

# Change user and group owner:
chown username:groupname filename
chown john:developers file.txt

# Change user, inherit user's primary group:
chown username: filename
chown john: file.txt
```

**chown Examples:**

```bash
# Change single file ownership:
chown alice document.txt        # Change owner to alice
chown alice:staff document.txt  # Change owner and group
chown :admin document.txt       # Change group only (same as chgrp)

# Multiple files:
chown alice *.txt               # Change owner of all .txt files
chown alice:staff dir/*         # Change ownership of all files in dir

# Recursive ownership change:
chown -R alice:staff /home/alice/projects/  # Change entire directory tree
chown -R apache:apache /var/www/html/       # Web server ownership

# Preserve root ownership for system files:
sudo chown root:root /etc/passwd
sudo chown -R root:root /etc/systemd/
```

#### chgrp Command (Change Group):

**Basic Usage:**

```bash
# Change group ownership:
chgrp groupname filename
chgrp developers script.sh
chgrp staff *.txt

# Recursive group change:
chgrp -R www-data /var/www/
chgrp -R developers /opt/project/

# Copy group from another file:
chgrp --reference=file1 file2
```

#### Practical Ownership Scenarios:

**Web Server Setup:**

```bash
# Apache web server ownership:
sudo chown -R www-data:www-data /var/www/html/
sudo chmod -R 755 /var/www/html/

# Allow group write access for developers:
sudo chgrp -R developers /var/www/html/
sudo chmod -R 775 /var/www/html/
```

**Shared Directory Setup:**

```bash
# Create shared project directory:
sudo mkdir /opt/shared-project
sudo chown root:developers /opt/shared-project
sudo chmod 775 /opt/shared-project

# Allow group members to create files:
sudo chmod g+s /opt/shared-project  # Set SGID
```

**User Home Directory Setup:**

```bash
# Fix home directory ownership:
sudo chown -R user:user /home/user/
sudo chmod 700 /home/user/
sudo chmod 755 /home/user/.ssh/
sudo chmod 600 /home/user/.ssh/id_rsa
```

**ðŸ“– References:**

- [chown Command Guide](https://linuxize.com/post/linux-chown-command/)
- [File Ownership Tutorial](https://www.cyberciti.biz/faq/how-to-use-chmod-and-chown-command/)

### 4. âœ… "Linux permission bits calculation"

#### Binary Representation:

**Permission Bit Structure:**

```bash
# 9 permission bits (3 groups of 3):
User    Group   Others
rwx     rwx     rwx
421     421     421

# Example: rwxr-xr-- = 754
User:  rwx = 4+2+1 = 7
Group: r-x = 4+0+1 = 5
Other: r-- = 4+0+0 = 4
Result: 754
```

**Permission Calculation Table:**

```bash
Binary  | Octal | Symbolic | Description
--------|-------|----------|------------
000     | 0     | ---      | No permissions
001     | 1     | --x      | Execute only
010     | 2     | -w-      | Write only
011     | 3     | -wx      | Write and execute
100     | 4     | r--      | Read only
101     | 5     | r-x      | Read and execute
110     | 6     | rw-      | Read and write
111     | 7     | rwx      | All permissions
```

#### Common Permission Combinations:

**File Permissions:**

```bash
644 (rw-r--r--)  # Standard file: owner read/write, others read
600 (rw-------)  # Private file: owner read/write only
755 (rwxr-xr-x)  # Executable: owner all, others read/execute
700 (rwx------)  # Private executable: owner only
444 (r--r--r--)  # Read-only: everyone read, no write
666 (rw-rw-rw-)  # Read/write for all (rarely used)
777 (rwxrwxrwx)  # All permissions for all (dangerous!)
```

**Directory Permissions:**

```bash
755 (rwxr-xr-x)  # Standard directory: owner all, others read/list
750 (rwxr-x---)  # Group accessible: owner all, group read/list
700 (rwx------)  # Private directory: owner only
775 (rwxrwxr-x)  # Group writable: owner/group all, others read/list
770 (rwxrwx---)  # Team directory: owner/group all, others none
```

#### Permission Calculation Examples:

**Step-by-step Calculation:**

```bash
# Example 1: rwxr-x---
User permissions:  rwx = 4+2+1 = 7
Group permissions: r-x = 4+0+1 = 5
Other permissions: --- = 0+0+0 = 0
Result: 750

# Example 2: rw-rw-r--
User permissions:  rw- = 4+2+0 = 6
Group permissions: rw- = 4+2+0 = 6
Other permissions: r-- = 4+0+0 = 4
Result: 664

# Example 3: r--r-----
User permissions:  r-- = 4+0+0 = 4
Group permissions: r-- = 4+0+0 = 4
Other permissions: --- = 0+0+0 = 0
Result: 440
```

**Quick Reference Script:**

```bash
#!/bin/bash
# Permission calculator script
calc_permissions() {
    local perm="$1"
    local result=0

    [[ $perm == *"r"* ]] && ((result += 4))
    [[ $perm == *"w"* ]] && ((result += 2))
    [[ $perm == *"x"* ]] && ((result += 1))

    echo $result
}

# Usage example:
# calc_permissions "rwx"  # Returns 7
# calc_permissions "r-x"  # Returns 5
```

**ðŸ“– Learn More:**

- [Linux Permission Calculator](https://www.rapidtables.com/code/linux/chmod.html)
- [Binary Permissions Explained](https://www.linux.com/training-tutorials/understanding-linux-file-permissions/)

### 5. âœ… "SUID SGID sticky bit Linux"

#### Special Permission Bits:

**Special Permissions Overview:**

```bash
SUID (Set User ID)     # 4xxx - Execute as file owner
SGID (Set Group ID)    # 2xxx - Execute as group owner (files) or inherit group (directories)
Sticky Bit             # 1xxx - Only owner can delete files in directory
```

#### SUID (Set User ID) - 4xxx:

**SUID Concept:**

```bash
# When SUID is set on executable file:
# - File executes with permissions of file owner (not current user)
# - Shown as 's' in owner execute position
# - Allows normal users to run privileged programs

# Example: passwd command
ls -l /usr/bin/passwd
-rwsr-xr-x 1 root root 59640 Jan 25 2022 /usr/bin/passwd
   ^
   â””â”€â”€ SUID bit set (s instead of x)
```

**SUID Examples:**

```bash
# Set SUID bit:
chmod 4755 program        # SUID + 755 permissions
chmod u+s program         # Add SUID bit symbolically
chmod 4755 /usr/local/bin/myprogram

# Remove SUID bit:
chmod 0755 program        # Remove special bits
chmod u-s program         # Remove SUID symbolically

# Find SUID files (potential security risk):
find / -perm -4000 -type f 2>/dev/null    # Find all SUID files
find /usr/bin -perm -4000 -ls             # SUID files in /usr/bin
```

**SUID Security Implications:**

```bash
# Common legitimate SUID programs:
/usr/bin/passwd       # Change password (needs root access)
/usr/bin/sudo         # Execute as another user
/usr/bin/su           # Switch user
/bin/ping             # ICMP packets (needs raw sockets)

# Security check:
find / -perm -4000 -user root -type f 2>/dev/null | grep -v -E '^/(bin|usr/bin|sbin|usr/sbin)/'
```

#### SGID (Set Group ID) - 2xxx:

**SGID on Files:**

```bash
# When SGID is set on executable:
# - File executes with permissions of file's group
# - Shown as 's' in group execute position

# Set SGID on file:
chmod 2755 program        # SGID + 755 permissions
chmod g+s program         # Add SGID symbolically
```

**SGID on Directories:**

```bash
# When SGID is set on directory:
# - New files inherit directory's group (not user's primary group)
# - Useful for shared project directories

# Create shared directory with SGID:
sudo mkdir /opt/shared-project
sudo chgrp developers /opt/shared-project
sudo chmod 2775 /opt/shared-project    # SGID + 775

# Test SGID behavior:
ls -ld /opt/shared-project
drwxrwsr-x 2 root developers 4096 Jan 15 10:30 /opt/shared-project
      ^
      â””â”€â”€ SGID bit set (s in group position)
```

#### Sticky Bit - 1xxx:

**Sticky Bit Concept:**

```bash
# When sticky bit is set on directory:
# - Only file owner (or root) can delete/rename files
# - Even if directory is world-writable
# - Shown as 't' in others execute position
# - Common on /tmp directory

# Example: /tmp directory
ls -ld /tmp
drwxrwxrwt 15 root root 4096 Jan 15 10:30 /tmp
        ^
        â””â”€â”€ Sticky bit set (t instead of x)
```

**Sticky Bit Usage:**

```bash
# Set sticky bit:
chmod 1777 directory      # Sticky bit + 777 permissions
chmod +t directory        # Add sticky bit symbolically
chmod 1755 shared_dir     # Sticky bit + 755

# Common sticky bit scenario:
sudo mkdir /var/shared
sudo chmod 1777 /var/shared   # Everyone can write, only owner can delete

# Remove sticky bit:
chmod 0777 directory      # Remove special bits
chmod -t directory        # Remove sticky bit
```

#### Special Permission Examples:

**Complete Special Permission Example:**

```bash
# Create directory with all special permissions:
mkdir test_special
chmod 7755 test_special   # SUID + SGID + Sticky + 755
ls -ld test_special
drwsrwsr-t 2 user group 4096 Jan 15 10:30 test_special
   ^ ^ ^
   â”‚ â”‚ â””â”€â”€ Sticky bit (t)
   â”‚ â””â”€â”€â”€â”€ SGID (s in group position)
   â””â”€â”€â”€â”€â”€â”€ SUID (s in user position)
```

**Finding Special Permission Files:**

```bash
# Find files with special permissions:
find / -perm -4000 -type f 2>/dev/null    # SUID files
find / -perm -2000 -type f 2>/dev/null    # SGID files
find / -perm -1000 -type d 2>/dev/null    # Sticky bit directories

# Find files with any special permission:
find / -perm /7000 -type f 2>/dev/null    # Any special bit set
```

**ðŸ“– Advanced Topics:**

- [SUID, SGID, Sticky Bit Explained](https://www.redhat.com/sysadmin/suid-sgid-sticky-bit)
- [Linux Special Permissions](https://www.thegeekdiary.com/understanding-special-permissions-in-linux-suid-sgid-and-sticky-bit/)

### 6. âœ… "umask command Linux default permissions"

#### umask Concept:

**What is umask:**

```bash
# umask (user file creation mode mask)
# - Defines default permissions for newly created files and directories
# - Works by subtracting permissions from default maximum
# - Default maximum: 666 for files, 777 for directories
# - Common umask values: 022, 002, 077
```

**umask Calculation:**

```bash
# File creation:
Maximum file permissions:       666 (rw-rw-rw-)
Default umask:                  022 (----w--w-)
Resulting file permissions:     644 (rw-r--r--)

# Directory creation:
Maximum directory permissions:  777 (rwxrwxrwx)
Default umask:                  022 (----w--w-)
Resulting directory permissions: 755 (rwxr-xr-x)
```

#### umask Command Usage:

**View Current umask:**

```bash
umask           # Show current umask (octal)
umask -S        # Show current umask (symbolic)

# Example output:
$ umask
022
$ umask -S
u=rwx,g=rx,o=rx
```

**Set umask:**

```bash
# Set umask for current session:
umask 022       # Conservative (group/others: read-only)
umask 002       # Collaborative (group: read/write, others: read-only)
umask 077       # Restrictive (owner only)
umask 000       # Permissive (not recommended)

# Set umask symbolically:
umask u=rwx,g=rx,o=rx    # Same as umask 022
umask u=rwx,g=rwx,o=     # Same as umask 007
```

#### Common umask Values:

**umask 022 (Default on most systems):**

```bash
umask 022
# Files:  666 - 022 = 644 (rw-r--r--)
# Dirs:   777 - 022 = 755 (rwxr-xr-x)

# Example:
touch testfile
mkdir testdir
ls -l
-rw-r--r-- 1 user group    0 Jan 15 10:30 testfile
drwxr-xr-x 2 user group 4096 Jan 15 10:30 testdir
```

**umask 002 (Group collaborative):**

```bash
umask 002
# Files:  666 - 002 = 664 (rw-rw-r--)
# Dirs:   777 - 002 = 775 (rwxrwxr-x)

# Good for team environments
```

**umask 077 (Restrictive):**

```bash
umask 077
# Files:  666 - 077 = 600 (rw-------)
# Dirs:   777 - 077 = 700 (rwx------)

# Maximum privacy, owner-only access
```

#### Setting Permanent umask:

**System-wide umask:**

```bash
# /etc/profile or /etc/bash.bashrc
umask 022

# /etc/login.defs (for login shells)
UMASK 022
```

**User-specific umask:**

```bash
# ~/.bashrc or ~/.profile
umask 022

# Make it permanent for current user:
echo "umask 022" >> ~/.bashrc
source ~/.bashrc
```

#### umask Testing:

**Test Different umask Values:**

```bash
#!/bin/bash
# Test script for umask behavior

for mask in 022 002 077 000; do
    echo "Testing umask $mask:"
    umask $mask

    # Create test files
    touch test_file_$mask
    mkdir test_dir_$mask

    # Show permissions
    ls -ld test_file_$mask test_dir_$mask
    echo
done

# Cleanup
rm -f test_file_*
rmdir test_dir_*
```

## ðŸ“š **Learning Resources:**

### Interactive Learning:

- **Linux Permissions Calculator**: https://chmod-calculator.com/
- **Permission Visualizer**: https://www.permissions-calculator.org/
- **Interactive Linux Tutorial**: https://linuxjourney.com/lesson/file-permissions

### Documentation:

- **GNU Coreutils Manual**: https://www.gnu.org/software/coreutils/manual/html_node/File-permissions.html
- **Linux File Permissions Guide**: https://wiki.archlinux.org/title/File_permissions_and_attributes
- **Red Hat Security Guide**: https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/managing-file-permissions_configuring-basic-system-settings

### Advanced Topics:

- **SELinux and Permissions**: https://www.redhat.com/en/topics/linux/what-is-selinux
- **AppArmor Security**: https://wiki.ubuntu.com/AppArmor
- **Linux Security Best Practices**: https://www.cyberciti.biz/tips/linux-security.html

## âœ… **Week 4 Completion Checklist:**

### Knowledge Verification:

- [ ] Understand rwx permissions for files and directories
- [ ] Can calculate octal permissions (755, 644, etc.)
- [ ] Know difference between chmod, chown, chgrp
- [ ] Understand special permissions (SUID, SGID, sticky bit)
- [ ] Can set and use umask effectively
- [ ] Understand ACL concepts and usage
- [ ] Know file attributes and their purposes

### Practical Skills:

- [ ] Set file permissions using both octal and symbolic notation
- [ ] Change file ownership and group ownership
- [ ] Use special permissions appropriately
- [ ] Configure umask for different scenarios
- [ ] Create and manage ACLs for complex permission needs
- [ ] Use file attributes for file protection
- [ ] Troubleshoot permission-related issues

### Command Mastery:

- [ ] chmod (octal and symbolic)
- [ ] chown and chgrp
- [ ] umask configuration
- [ ] getfacl and setfacl
- [ ] lsattr and chattr
- [ ] Find files with specific permissions

### Security Understanding:

- [ ] Recognize security implications of permissions
- [ ] Identify potentially dangerous permission settings
- [ ] Understand principle of least privilege
- [ ] Know how to audit file permissions

### Next Steps:

- [ ] Week 5: Text Processing and Searching
- [ ] Apply permission concepts to real projects
- [ ] Study advanced security topics (SELinux, AppArmor)
- [ ] Practice with multi-user system scenarios

**Estimated Time**: 18-22 hours over 7 days
**Success Criteria**: Complete 85%+ of checklist and practical exercises
**Security Focus**: Always consider security implications when setting permissions
