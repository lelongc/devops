## 1\. `etcd` là gì?

Bạn có thể nghĩ về **`etcd`** như một cơ sở dữ liệu đặc biệt. Theo định nghĩa, nó là một **kho lưu trữ khóa-giá trị (key-value store)** có các đặc tính sau:

- **Phân tán (Distributed):** Dữ liệu được trải rộng trên nhiều máy chủ.
- **Đáng tin cậy (Reliable):** Đảm bảo dữ liệu không bị mất mát.
- **Đơn giản, an toàn và nhanh chóng.**

Trong Kubernetes, `etcd` chính là "bộ não" lưu trữ toàn bộ trạng thái và cấu hình của cả cụm.

---

## 2\. Key-Value Store khác gì Cơ sở dữ liệu truyền thống (SQL)? 🤔

Đây là điểm khác biệt cốt lõi bạn cần nắm:

- **Cơ sở dữ liệu truyền thống (SQL):**

  - Lưu dữ liệu dưới dạng **bảng (table)** với các **hàng (row)** và **cột (column)** được định nghĩa nghiêm ngặt.
  - _Ví dụ:_ Một bảng thông tin nhân viên. Nếu bạn muốn thêm một loại thông tin mới (ví dụ: `lương`), bạn phải thêm một cột mới cho **toàn bộ bảng**, ảnh hưởng đến tất cả các hàng, kể cả những người không có thông tin lương (dẫn đến nhiều ô trống).

- **Kho lưu trữ Key-Value (như `etcd`):**

  - Lưu thông tin dưới dạng các cặp **Khóa (Key) = Giá trị (Value)**, giống như các **tài liệu (document)** riêng lẻ.
  - _Ví dụ:_ Mỗi người có một "tài liệu" riêng. Người đi làm thì có trường `lương` trong tài liệu của họ. Học sinh thì có trường `điểm` trong tài liệu của họ.
  - **Lợi ích:** Cấu trúc rất **linh hoạt**. Bạn có thể thêm một trường mới vào một tài liệu mà không ảnh hưởng gì đến các tài liệu khác. Dữ liệu phức tạp thường được lưu dưới dạng JSON hoặc YAML.

---

## 3\. Bắt đầu với `etcd`

Việc cài đặt và chạy `etcd` rất đơn giản:

1.  **Tải về (Download):** Lấy file nhị phân (binary) phù hợp với hệ điều hành của bạn từ trang GitHub của `etcd`.
2.  **Giải nén (Unzip):** Giải nén file vừa tải.
3.  **Chạy (Run):** Chạy file thực thi `etcd`.
    - Mặc định, `etcd` sẽ khởi động một dịch vụ và lắng nghe trên cổng **`2379`**.

Sau khi chạy, bạn có thể dùng một "client" để giao tiếp với nó. Client mặc định đi kèm là **`etcdctl`**.

---

## 4\. "Cú lừa" về phiên bản: `etcdctl` v2 vs. v3 ⚠️

Đây là phần **quan trọng nhất và dễ gây nhầm lẫn nhất** cho người mới bắt đầu\!

Giữa phiên bản `etcd` v2 và v3 có sự thay đổi lớn về API, dẫn đến các lệnh `etcdctl` cũng thay đổi theo.

- **Làm sao để biết `etcdctl` đang dùng API phiên bản nào?**

  - Chạy lệnh: `etcdctl version`
  - Lệnh này sẽ hiển thị phiên bản của công cụ `etcdctl` và quan trọng hơn là **phiên bản API** mà nó đang được cấu hình để sử dụng (là `2` hoặc `3`).

- **Làm sao để chuyển sang dùng API v3?**

  - Các phiên bản `etcdctl` mới hơn thường mặc định dùng API v3. Nhưng nếu bạn gặp phiên bản cũ hơn, bạn cần ra lệnh cho nó dùng API v3.
  - Cách tốt nhất là đặt biến môi trường cho toàn bộ phiên làm việc của bạn bằng lệnh:
    ```bash
    export ETCDCTL_API=3
    ```

- **So sánh lệnh giữa v2 và v3:**

| Tác vụ            | Lệnh API v2                           | Lệnh API v3                     |
| :---------------- | :------------------------------------ | :------------------------------ |
| **Lưu giá trị**   | `etcdctl set key1 value1`             | `etcdctl put key1 value1`       |
| **Lấy giá trị**   | `etcdctl get key1`                    | `etcdctl get key1`              |
| **Xem phiên bản** | `etcdctl --version` (là một tùy chọn) | `etcdctl version` (là một lệnh) |

Việc `set` đổi thành `put` là thay đổi dễ nhận thấy nhất.

---

## 5\. "Chốt hạ" cho người mới bắt đầu 📝

- **`etcd`** là một kho lưu trữ **key-value** linh hoạt, là "bộ não" của Kubernetes.
- Việc cài đặt và chạy nó khá đơn giản, mặc định ở cổng **2379**.
- Khi sử dụng `etcdctl`, hãy luôn chắc chắn rằng bạn đang làm việc với **API v3** bằng cách kiểm tra (`etcdctl version`) và thiết lập biến môi trường (`export ETCDCTL_API=3`). Đây là mẹo thực tế quan trọng nhất để tránh lỗi không đáng có.
