### 1\. B·ªën "Tr·ª• c·ªôt" c·ªßa m·ªôt file YAML trong Kubernetes

M·ªçi file ƒë·ªãnh nghƒ©a ƒë·ªëi t∆∞·ª£ng trong Kubernetes (d√π l√† Pod, Service, hay Deployment,...) ƒë·ªÅu ph·∫£i c√≥ **4 tr∆∞·ªùng (fields) ·ªü c·∫•p cao nh·∫•t**. ƒê√¢y l√† c√°c tr∆∞·ªùng b·∫Øt bu·ªôc:

1. **`apiVersion`**:

   - **L√† g√¨?** Phi√™n b·∫£n c·ªßa Kubernetes API m√† b·∫°n ƒëang s·ª≠ d·ª•ng ƒë·ªÉ t·∫°o ƒë·ªëi t∆∞·ª£ng.
   - **V√≠ d·ª• (cho Pod):** `v1`

2. **`kind`**:

   - **L√† g√¨?** Lo·∫°i ƒë·ªëi t∆∞·ª£ng m√† b·∫°n ƒëang mu·ªën t·∫°o.
   - **V√≠ d·ª• (cho Pod):** `Pod`

3. **`metadata`**:

   - **L√† g√¨?** "D·ªØ li·ªáu v·ªÅ d·ªØ li·ªáu" - t·ª©c l√† c√°c th√¥ng tin m√¥ t·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng, nh∆∞ t√™n, nh√£n,... ƒê√¢y l√† m·ªôt dictionary (ƒë·ªëi t∆∞·ª£ng).
   - **`name`**: T√™n c·ªßa Pod (v√≠ d·ª•: `my-app-pod`).
   - **`labels`**: M·ªôt dictionary ch·ª©a c√°c c·∫∑p key-value (nh√£n). Labels c·ª±c k·ª≥ quan tr·ªçng, gi√∫p b·∫°n l·ªçc v√† nh√≥m c√°c ƒë·ªëi t∆∞·ª£ng sau n√†y (v√≠ d·ª•: `app: my-app`, `env: production`).

4. **`spec`** (vi·∫øt t·∫Øt c·ªßa Specification):

   - **L√† g√¨?** ƒê√¢y l√† ph·∫ßn quan tr·ªçng nh·∫•t, n∆°i b·∫°n ƒë·ªãnh nghƒ©a **tr·∫°ng th√°i mong mu·ªën** c·ªßa ƒë·ªëi t∆∞·ª£ng.
   - C·∫•u tr√∫c c·ªßa `spec` s·∫Ω **kh√°c nhau t√πy thu·ªôc v√†o `kind`** c·ªßa ƒë·ªëi t∆∞·ª£ng.

> ‚ö†Ô∏è **L∆∞u √Ω v·ªÅ th·ª•t ƒë·∫ßu d√≤ng (indentation) trong YAML:** YAML r·∫•t nh·∫°y c·∫£m v·ªõi kho·∫£ng tr·∫Øng. C√°c thu·ªôc t√≠nh con ph·∫£i ƒë∆∞·ª£c th·ª•t v√†o so v·ªõi thu·ªôc t√≠nh cha, v√† c√°c thu·ªôc t√≠nh ngang h√†ng ph·∫£i c√≥ c√πng m·ª©c th·ª•t l·ªÅ.

---

### 2\. "M·ªï x·∫ª" ph·∫ßn `spec` c·ªßa m·ªôt Pod

ƒê·ªëi v·ªõi m·ªôt ƒë·ªëi t∆∞·ª£ng c√≥ `kind: Pod`, ph·∫ßn `spec` s·∫Ω m√¥ t·∫£ c√°c container s·∫Ω ch·∫°y b√™n trong Pod ƒë√≥.

- `spec` ch·ª©a m·ªôt thu·ªôc t√≠nh quan tr·ªçng l√† **`containers`**.
- **`containers`** l√† m·ªôt **danh s√°ch (list/array)**. L√Ω do n√≥ l√† m·ªôt danh s√°ch v√¨ m·ªôt Pod c√≥ th·ªÉ ch·ª©a nhi·ªÅu container.
- M·ªói m·ª•c trong danh s√°ch `containers` l√† m·ªôt dictionary m√¥ t·∫£ m·ªôt container, v·ªõi hai thu·ªôc t√≠nh b·∫Øt bu·ªôc:
  - **`name`**: T√™n b·∫°n ƒë·∫∑t cho container (v√≠ d·ª•: `nginx-container`).
  - **`image`**: T√™n c·ªßa Docker image s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ch·∫°y container (v√≠ d·ª•: `nginx`).

---

### 3\. V√≠ d·ª• m·ªôt file `pod-definition.yaml` ho√†n ch·ªânh

ƒê√¢y l√† m·ªôt file YAML ƒë·∫ßy ƒë·ªß ƒë·ªÉ t·∫°o m·ªôt Pod ƒë∆°n gi·∫£n ch·∫°y NGINX:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app-pod
  labels:
    app: my-app
spec:
  containers:
    - name: nginx-container
      image: nginx
```

---

### 4. Th·ª±c thi v√† Qu·∫£n l√Ω Pod trong Kubernetes

#### 4.1. T·∫°o Pod t·ª´ file YAML

```bash
# T·∫°o Pod (b√°o l·ªói n·∫øu ƒë√£ t·ªìn t·∫°i)
kubectl create -f pod-definition.yaml

# T·∫°o ho·∫∑c c·∫≠p nh·∫≠t Pod (khuy·∫øn ngh·ªã)
kubectl apply -f pod-definition.yaml
```

#### 4.2. Ki·ªÉm tra v√† Gi√°m s√°t Pod

```bash
# Xem danh s√°ch Pod
kubectl get pods
kubectl get pods -o wide                    # Th√¥ng tin chi ti·∫øt
kubectl get pods -l app=my-app             # L·ªçc theo label
kubectl get pods -A                        # T·∫•t c·∫£ namespace

# Xem th√¥ng tin chi ti·∫øt
kubectl describe pod my-app-pod

# Theo d√µi logs
kubectl logs my-app-pod
kubectl logs -f my-app-pod                 # Theo th·ªùi gian th·ª±c
```

#### 4.3. T∆∞∆°ng t√°c v·ªõi Pod

```bash
# Truy c·∫≠p v√†o container
kubectl exec -it my-app-pod -- /bin/bash

# Ch·∫°y l·ªánh trong container
kubectl exec my-app-pod -- ls -la

# Port forwarding
kubectl port-forward my-app-pod 8080:80
```

#### 4.4. X√≥a Pod

```bash
kubectl delete pod my-app-pod
kubectl delete -f pod-definition.yaml
kubectl delete pods -l app=my-app          # X√≥a theo label
```

---

### 5. T·∫°o Pod nhanh v·ªõi kubectl run

#### 5.1. C√°c l·ªánh c∆° b·∫£n

```bash
# T·∫°o Pod ƒë∆°n gi·∫£n
kubectl run nginx-pod --image=nginx

# T·∫°o Pod v·ªõi labels v√† port
kubectl run webapp --image=nginx --port=80 --labels="app=web,env=prod"

# T·∫°o file YAML (kh√¥ng t·∫°o Pod th·ª±c t·∫ø)
kubectl run redis-pod --image=redis --dry-run=client -o yaml > redis-pod.yaml
```

#### 5.2. Pod v·ªõi c·∫•u h√¨nh n√¢ng cao

```yaml
# nginx-advanced.yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-advanced
  labels:
    app: nginx
    tier: frontend
spec:
  containers:
    - name: nginx-container
      image: nginx:1.21
      ports:
        - containerPort: 80
      resources:
        requests:
          memory: "64Mi"
          cpu: "250m"
        limits:
          memory: "128Mi"
          cpu: "500m"
      env:
        - name: NGINX_PORT
          value: "80"
```

---

### 6. Troubleshooting v√† Debug Pod

#### 6.1. Ki·ªÉm tra tr·∫°ng th√°i

```bash
# Xem Pod c√≥ v·∫•n ƒë·ªÅ
kubectl get pods --field-selector=status.phase!=Running

# Xem events h·ªá th·ªëng
kubectl get events --sort-by=.metadata.creationTimestamp

# Theo d√µi tr·∫°ng th√°i realtime
kubectl get pods -w
```

#### 6.2. Ph√¢n t√≠ch v√† Debug

```bash
# Xem resource usage
kubectl top pods

# Xem c·∫•u h√¨nh Pod ·ªü d·∫°ng YAML
kubectl get pod nginx-pod -o yaml

# Xem logs container tr∆∞·ªõc ƒë√≥
kubectl logs nginx-pod --previous
```

---

### 7. Lab th·ª±c h√†nh t·ªïng h·ª£p

```bash
# 1. T·∫°o Pod v·ªõi labels
kubectl run webapp --image=nginx:1.21 --port=80 --labels="app=webapp,env=prod"

# 2. Ki·ªÉm tra v√† theo d√µi
kubectl get pods -l app=webapp
kubectl describe pod webapp
kubectl logs webapp

# 3. Test k·∫øt n·ªëi
kubectl port-forward webapp 8080:80 &
curl localhost:8080

# 4. Backup v√† cleanup
kubectl get pod webapp -o yaml > webapp-backup.yaml
kubectl delete pod webapp
```

---

### 8. T√≥m t·∫Øt cho k·ª≥ thi CKA üìù

**4 tr∆∞·ªùng b·∫Øt bu·ªôc c·ªßa YAML:**

- `apiVersion: v1` (cho Pod)
- `kind: Pod`
- `metadata`: name, labels
- `spec`: containers (name, image)

**L·ªánh quan tr·ªçng:**

- `kubectl apply -f file.yaml` - T·∫°o/c·∫≠p nh·∫≠t
- `kubectl get pods -o wide` - Xem danh s√°ch
- `kubectl describe pod <name>` - Debug
- `kubectl logs <pod>` - Xem logs
- `kubectl exec -it <pod> -- /bin/bash` - Truy c·∫≠p container

**Tips:**

- Lu√¥n s·ª≠ d·ª•ng `apply` thay v√¨ `create`
- Labels quan tr·ªçng cho vi·ªác qu·∫£n l√Ω
- S·ª≠ d·ª•ng `describe` ƒë·ªÉ troubleshoot
- `dry-run` ƒë·ªÉ t·∫°o YAML template nhanh
