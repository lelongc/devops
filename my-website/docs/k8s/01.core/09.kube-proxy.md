### 1. BÃ i toÃ¡n: Giao tiáº¿p giá»¯a cÃ¡c Pod vÃ  sá»± "ká»³ diá»‡u" cá»§a Service

Trong má»™t cá»¥m Kubernetes, cÃ¡c Pod cÃ³ thá»ƒ giao tiáº¿p vá»›i nhau. Tuy nhiÃªn, Ä‘á»‹a chá»‰ IP cá»§a Pod khÃ´ng á»•n Ä‘á»‹nh, chÃºng cÃ³ thá»ƒ thay Ä‘á»•i khi Pod Ä‘Æ°á»£c táº¡o láº¡i. VÃ¬ váº­y, chÃºng ta khÃ´ng nÃªn Ä‘á»ƒ má»™t Pod gá»i trá»±c tiáº¿p Ä‘áº¿n IP cá»§a Pod khÃ¡c.

ğŸ‘‰ **Giáº£i phÃ¡p lÃ  dÃ¹ng `Service`**. Service cung cáº¥p má»™t "Ä‘á»‹a chá»‰" á»•n Ä‘á»‹nh (dÆ°á»›i dáº¡ng tÃªn hoáº·c má»™t Ä‘á»‹a chá»‰ IP áº£o gá»i lÃ  ClusterIP) Ä‘á»ƒ cÃ¡c Pod khÃ¡c cÃ³ thá»ƒ tÃ¬m Ä‘áº¿n.

**CÃ¢u há»i Ä‘áº·t ra:** Service chá»‰ lÃ  má»™t Ä‘á»‘i tÆ°á»£ng "áº£o" trong bá»™ nhá»› cá»§a Kubernetes, nÃ³ khÃ´ng pháº£i lÃ  má»™t Pod hay container thá»±c sá»±. Váº­y lÃ m tháº¿ nÃ o mÃ  traffic cÃ³ thá»ƒ Ä‘Æ°á»£c gá»­i Ä‘áº¿n má»™t Ä‘á»‹a chá»‰ IP "áº£o" vÃ  Ä‘áº¿n Ä‘Æ°á»£c Ä‘Ãºng Pod tháº­t?

---

### 2. `kube-proxy` - "áº¢o thuáº­t gia" Máº¡ng cá»§a Kubernetes ğŸ©âœ¨

**`kube-proxy`** chÃ­nh lÃ  cÃ¢u tráº£ lá»i! NÃ³ lÃ  "nhÃ  áº£o thuáº­t" biáº¿n cÃ¡c Service "áº£o" trá»Ÿ nÃªn "tháº­t".

- **`kube-proxy` lÃ  gÃ¬?** NÃ³ lÃ  má»™t tiáº¿n trÃ¬nh (process) cháº¡y trÃªn **Má»–I NODE** trong cá»¥m Kubernetes (cáº£ master vÃ  worker).
- **Nhiá»‡m vá»¥ cá»§a nÃ³ lÃ  gÃ¬?**
  1.  NÃ³ liÃªn tá»¥c theo dÃµi `kube-api-server` Ä‘á»ƒ xem cÃ³ Service nÃ o má»›i Ä‘Æ°á»£c táº¡o, sá»­a, hay xÃ³a khÃ´ng.
  2.  Má»—i khi cÃ³ má»™t Service má»›i, `kube-proxy` sáº½ **táº¡o ra cÃ¡c quy táº¯c máº¡ng (network rules) trÃªn chÃ­nh cÃ¡i Node mÃ  nÃ³ Ä‘ang cháº¡y**.

---

### 3. "MÃ n áº£o thuáº­t" hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?

- Má»™t trong nhá»¯ng cÃ¡ch `kube-proxy` thá»±c hiá»‡n Ä‘iá»u nÃ y lÃ  sá»­ dá»¥ng **`iptables`** (má»™t cÃ´ng cá»¥ tÆ°á»ng lá»­a/Ä‘á»‹nh tuyáº¿n ráº¥t phá»• biáº¿n trÃªn Linux).
- _VÃ­ dá»¥:_
  - Báº¡n táº¡o má»™t Service tÃªn `db-service` vá»›i IP áº£o lÃ  `10.96.0.12`.
  - Service nÃ y trá» Ä‘áº¿n má»™t Pod database cÃ³ IP tháº­t lÃ  `10.32.0.15`.
  - `kube-proxy` trÃªn **má»—i node** sáº½ táº¡o má»™t rule `iptables` cÃ³ ná»™i dung Ä‘áº¡i loáº¡i nhÆ°: _"NÃ y há»‡ Ä‘iá»u hÃ nh, náº¿u cÃ³ báº¥t ká»³ gÃ³i tin nÃ o gá»­i Ä‘áº¿n Ä‘á»‹a chá»‰ `10.96.0.12`, hÃ£y chuyá»ƒn hÆ°á»›ng (redirect) nÃ³ Ä‘áº¿n Ä‘á»‹a chá»‰ `10.32.0.15` nhÃ©!"_
- Nhá» váº­y, tá»« báº¥t ká»³ node nÃ o trong cá»¥m, khi má»™t Pod khÃ¡c gá»­i request Ä‘áº¿n IP cá»§a `db-service`, request Ä‘Ã³ sáº½ Ä‘Æ°á»£c chuyá»ƒn hÆ°á»›ng má»™t cÃ¡ch ká»³ diá»‡u Ä‘áº¿n Ä‘Ãºng Pod database tháº­t sá»±.

---

### 4. CÃ¡ch `kube-proxy` Ä‘Æ°á»£c triá»ƒn khai

- **"Thá»§ cÃ´ng" (From Scratch):** Báº¡n táº£i file binary cá»§a `kube-proxy` vÃ  cháº¡y nÃ³ nhÆ° má»™t service.
- **DÃ¹ng `kubeadm`:** `kubeadm` sáº½ triá»ƒn khai `kube-proxy` dÆ°á»›i dáº¡ng cÃ¡c Pod trÃªn má»—i node.
  - Cá»¥ thá»ƒ hÆ¡n, nÃ³ Ä‘Æ°á»£c triá»ƒn khai báº±ng má»™t Ä‘á»‘i tÆ°á»£ng Kubernetes gá»i lÃ  **`DaemonSet`**.
  - **`DaemonSet`** Ä‘áº£m báº£o ráº±ng má»™t báº£n sao cá»§a Pod (trong trÆ°á»ng há»£p nÃ y lÃ  Pod `kube-proxy`) sáº½ **luÃ´n cháº¡y trÃªn má»—i node** cá»§a cá»¥m. ÄÃ¢y lÃ  cÃ¡ch hoÃ n háº£o Ä‘á»ƒ triá»ƒn khai cÃ¡c agent cáº§n cÃ³ máº·t á»Ÿ kháº¯p má»i nÆ¡i nhÆ° `kube-proxy`.

---

### 5. "Chá»‘t háº¡" cho Ká»³ thi CKA ğŸ“

- `kube-proxy` cháº¡y trÃªn **má»—i node** trong cá»¥m.
- Nhiá»‡m vá»¥ chÃ­nh cá»§a nÃ³ lÃ  **hiá»‡n thá»±c hÃ³a cÆ¡ cháº¿ cá»§a Kubernetes Service**.
- NÃ³ lÃ m Ä‘iá»u nÃ y báº±ng cÃ¡ch theo dÃµi API Server vÃ  táº¡o ra cÃ¡c **quy táº¯c máº¡ng** (vÃ­ dá»¥: `iptables`) trÃªn node Ä‘á»ƒ Ä‘á»‹nh tuyáº¿n traffic tá»« IP áº£o cá»§a Service Ä‘áº¿n IP tháº­t cá»§a cÃ¡c Pod.
- Trong má»™t cá»¥m `kubeadm`, `kube-proxy` Ä‘Æ°á»£c triá»ƒn khai nhÆ° má»™t **`DaemonSet`**.
