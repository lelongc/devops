Ä‘á»‘i tÆ°á»£ng máº¡nh máº½ vÃ  Ä‘Æ°á»£c sá»­ dá»¥ng nhiá»u nháº¥t Ä‘á»ƒ quáº£n lÃ½ á»©ng dá»¥ng, Ä‘Ã³ lÃ  **Kubernetes Deployment**.

---

### 1\. BÃ i toÃ¡n Quáº£n lÃ½ á»¨ng dá»¥ng trong "Tháº¿ giá»›i Thá»±c" ğŸŒ

![1751353602022](image/14.deployment/1751353602022.png)
Khi triá»ƒn khai á»©ng dá»¥ng trong mÃ´i trÆ°á»ng thá»±c táº¿ (production), chÃºng ta thÆ°á»ng Ä‘á»‘i máº·t vá»›i cÃ¡c yÃªu cáº§u sau:

- **Nhiá»u báº£n sao:** Cáº§n cháº¡y nhiá»u instance cá»§a á»©ng dá»¥ng Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh sáºµn sÃ ng cao vÃ  cÃ¢n báº±ng táº£i.
- **Cáº­p nháº­t liá»n máº¡ch:** Khi cÃ³ phiÃªn báº£n má»›i, cáº§n nÃ¢ng cáº¥p á»©ng dá»¥ng mÃ  khÃ´ng gÃ¢y giÃ¡n Ä‘oáº¡n dá»‹ch vá»¥. ÄÃ¢y gá»i lÃ  **Rolling Updates**.
- **Quay lui (Rollback):** Náº¿u phiÃªn báº£n má»›i bá»‹ lá»—i, cáº§n cÃ³ kháº£ nÄƒng quay trá»Ÿ láº¡i phiÃªn báº£n cÅ© má»™t cÃ¡ch nhanh chÃ³ng.
- **Táº¡m dá»«ng & Tiáº¿p tá»¥c:** ÄÃ´i khi cáº§n táº¡m dá»«ng quÃ¡ trÃ¬nh thay Ä‘á»•i, thá»±c hiá»‡n nhiá»u cáº¥u hÃ¬nh cÃ¹ng lÃºc, rá»“i má»›i tiáº¿p tá»¥c Ä‘á»ƒ táº¥t cáº£ Ä‘Æ°á»£c Ã¡p dá»¥ng má»™t láº§n.

---

### 2\. `Deployment` - "Vá»‹ tÆ°á»›ng" Chá»‰ huy Tá»‘i cao ğŸ–ï¸

**Deployment** chÃ­nh lÃ  Ä‘á»‘i tÆ°á»£ng Kubernetes Ä‘Æ°á»£c sinh ra Ä‘á»ƒ giáº£i quyáº¿t táº¥t cáº£ cÃ¡c bÃ i toÃ¡n trÃªn. NÃ³ lÃ  má»™t Ä‘á»‘i tÆ°á»£ng quáº£n lÃ½ cáº¥p cao hÆ¡n, Ä‘á»©ng trÃªn cáº£ ReplicaSet vÃ  Pod.

ÄÃ¢y lÃ  há»‡ thá»‘ng phÃ¢n cáº¥p báº¡n cáº§n nhá»›:

**Deployment** â¡ï¸ quáº£n lÃ½ â¡ï¸ **ReplicaSet** â¡ï¸ quáº£n lÃ½ â¡ï¸ **Pods**

> **Äiá»ƒm máº¥u chá»‘t:** Má»™t Deployment khÃ´ng quáº£n lÃ½ trá»±c tiáº¿p cÃ¡c Pod. Thay vÃ o Ä‘Ã³, nÃ³ quáº£n lÃ½ cÃ¡c ReplicaSet. Khi báº¡n táº¡o hoáº·c cáº­p nháº­t má»™t Deployment, nÃ³ sáº½ táº¡o ra má»™t ReplicaSet má»›i, vÃ  chÃ­nh ReplicaSet Ä‘Ã³ sáº½ chá»‹u trÃ¡ch nhiá»‡m táº¡o ra cÃ¡c Pod.

---

### 3\. "Giáº£i pháº«u" má»™t file YAML cá»§a Deployment ğŸ§¬

Tin vui lÃ  file Ä‘á»‹nh nghÄ©a cá»§a Deployment **gáº§n nhÆ° y há»‡t** file Ä‘á»‹nh nghÄ©a cá»§a ReplicaSet\!

- Sá»± khÃ¡c biá»‡t chÃ­nh vÃ  duy nháº¥t báº¡n cáº§n thay Ä‘á»•i lÃ  `kind`.
- **`kind: Deployment`**

Má»i thá»© khÃ¡c nhÆ° `apiVersion: apps/v1`, `metadata`, vÃ  `spec` (vá»›i `replicas`, `selector`, `template`) Ä‘á»u giá»¯ nguyÃªn.

```yaml
apiVersion: apps/v1
kind: Deployment # <-- Chá»‰ thay Ä‘á»•i á»Ÿ Ä‘Ã¢y
metadata:
  name: myapp-deployment
  labels:
    app: myapp
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
        - name: nginx-container
          image: nginx
```

---

### 4\. Äiá»u gÃ¬ xáº£y ra khi báº¡n táº¡o má»™t Deployment? ğŸš€

Khi báº¡n cháº¡y lá»‡nh `kubectl create -f deployment-definition.yaml`, má»™t chuá»—i pháº£n á»©ng sáº½ xáº£y ra:

1. Má»™t Ä‘á»‘i tÆ°á»£ng **Deployment** Ä‘Æ°á»£c táº¡o.
2. Deployment controller ngay láº­p tá»©c táº¡o ra má»™t Ä‘á»‘i tÆ°á»£ng **ReplicaSet** má»›i dá»±a trÃªn `template` cá»§a Deployment.
3. ReplicaSet controller tiáº¿p quáº£n vÃ  táº¡o ra Ä‘á»§ sá»‘ lÆ°á»£ng **Pods** theo yÃªu cáº§u (`replicas: 3`).

---

### 5\. CÃ¡c Lá»‡nh Kiá»ƒm tra Há»¯u Ã­ch âœ…

- **Xem Deployment:** `kubectl get deployment`
- **Xem ReplicaSet:** `kubectl get replicaset` (Báº¡n sáº½ tháº¥y má»™t ReplicaSet má»›i Ä‘Æ°á»£c táº¡o bá»Ÿi Deployment , cÃ³ prefix cá»§a Deployment).
- **Xem Pods:** `kubectl get pods` (TÃªn cÃ¡c Pod sáº½ cÃ³ prefix cá»§a Deployment vÃ  ReplicaSet).
- **Xem táº¥t cáº£:** Má»™t lá»‡nh ráº¥t tiá»‡n lá»£i lÃ  `kubectl get all`. NÃ³ sáº½ liá»‡t kÃª táº¥t cáº£ cÃ¡c Ä‘á»‘i tÆ°á»£ng liÃªn quan (Deployment, ReplicaSet, Pods, vÃ  cáº£ Service náº¿u cÃ³).

---

### 6\. "Chá»‘t háº¡" cho Ká»³ thi CKA ğŸ“

- **Deployment** lÃ  Ä‘á»‘i tÆ°á»£ng Ä‘Æ°á»£c **khuyáº¿n khÃ­ch sá»­ dá»¥ng** Ä‘á»ƒ quáº£n lÃ½ cÃ¡c á»©ng dá»¥ng khÃ´ng tráº¡ng thÃ¡i (stateless applications).
- NÃ³ cung cáº¥p cÃ¡c tÃ­nh nÄƒng quáº£n lÃ½ vÃ²ng Ä‘á»i á»©ng dá»¥ng nÃ¢ng cao nhÆ° **rolling updates** vÃ  **rollbacks** (sáº½ tÃ¬m hiá»ƒu chi tiáº¿t sau).
- HÃ£y nhá»› ká»¹ há»‡ thá»‘ng phÃ¢n cáº¥p: **Deployment quáº£n lÃ½ ReplicaSet, ReplicaSet quáº£n lÃ½ Pods.**
- Cáº¥u trÃºc file YAML cá»§a Deployment gáº§n nhÆ° giá»‘ng há»‡t ReplicaSet, chá»‰ cáº§n Ä‘á»•i `kind` thÃ nh `Deployment`.

---

### 7. Lab Thá»±c hÃ nh: Deployment trong Kubernetes ğŸ§ª

ChÃºng ta sáº½ thá»±c hÃ nh tá»«ng bÆ°á»›c Ä‘á»ƒ hiá»ƒu rÃµ cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a Deployment:

#### **BÆ°á»›c 1: Táº¡o Pod Ä‘Æ¡n giáº£n vá»›i NGINX**

```bash
kubectl run nginx --image=nginx
```

#### **BÆ°á»›c 2: Táº¡o file YAML cho Pod (khÃ´ng deploy)**

```bash
kubectl run nginx --image=nginx --dry-run=client -o yaml
```

#### **BÆ°á»›c 3: Táº¡o Deployment Ä‘Æ¡n giáº£n**

```bash
kubectl create deployment --image=nginx nginx
```

#### **BÆ°á»›c 4: Táº¡o file YAML cho Deployment (khÃ´ng deploy)**

```bash
kubectl create deployment --image=nginx nginx --dry-run=client -o yaml
```

#### **BÆ°á»›c 5: LÆ°u file YAML vÃ  chá»‰nh sá»­a**

```bash
kubectl create deployment --image=nginx nginx --dry-run=client -o yaml > nginx-deployment.yaml
```

Sau Ä‘Ã³ chá»‰nh sá»­a file `nginx-deployment.yaml` Ä‘á»ƒ thÃªm sá»‘ replica:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
      name: nginx
spec:
      replicas: 3  # Thay Ä‘á»•i tá»« 1 thÃ nh 3
      selector:
            matchLabels:
                  app: nginx
      template:
            metadata:
                  labels:
                        app: nginx
            spec:
                  containers:
                  - image: nginx
                        name: nginx
```

#### **BÆ°á»›c 6: Deploy tá»« file YAML**

```bash
kubectl create -f nginx-deployment.yaml
```

#### **BÆ°á»›c 7: Táº¡o Deployment vá»›i replica ngay tá»« Ä‘áº§u (k8s 1.19+)**

```bash
kubectl create deployment --image=nginx nginx --replicas=4 --dry-run=client -o yaml > nginx-deployment.yaml
```

#### **BÆ°á»›c 8: Kiá»ƒm tra káº¿t quáº£**

```bash
# Xem táº¥t cáº£ objects
kubectl get all

# Xem chi tiáº¿t Deployment
kubectl get deployment

# Xem chi tiáº¿t ReplicaSet (Ä‘Æ°á»£c táº¡o bá»Ÿi Deployment)
kubectl get replicaset

# Xem chi tiáº¿t Pods
kubectl get pods

# Xem thÃ´ng tin chi tiáº¿t cá»§a Deployment
kubectl describe deployment nginx
```

#### **BÆ°á»›c 9: Thá»­ nghiá»‡m Scale Up/Down**

```bash
# Scale up to 6 replicas
kubectl scale deployment nginx --replicas=6

# Scale down to 2 replicas
kubectl scale deployment nginx --replicas=2

# Kiá»ƒm tra
kubectl get pods
```

#### **BÆ°á»›c 10: Dá»n dáº¹p**

```bash
kubectl delete deployment nginx
```

> **ğŸ’¡ Ghi chÃº quan trá»ng:** Khi báº¡n xÃ³a Deployment, táº¥t cáº£ ReplicaSet vÃ  Pod con cá»§a nÃ³ cÅ©ng sáº½ bá»‹ xÃ³a theo. ÄÃ¢y chÃ­nh lÃ  sá»©c máº¡nh cá»§a há»‡ thá»‘ng phÃ¢n cáº¥p trong Kubernetes!

---
