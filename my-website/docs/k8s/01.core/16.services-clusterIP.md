### 1\. BÃ i toÃ¡n: Giao tiáº¿p "Ná»™i bá»™" trong Kiáº¿n trÃºc Microservices ğŸ—£ï¸

![1751439352659](image/16.services-clusterIP/1751439352659.png)

HÃ£y tÆ°á»Ÿng tÆ°á»£ng má»™t á»©ng dá»¥ng web hoÃ n chá»‰nh thÆ°á»ng cÃ³ nhiá»u táº§ng (tiers):

- Má»™t nhÃ³m Pod cháº¡y **frontend** (giao diá»‡n ngÆ°á»i dÃ¹ng).
- Má»™t nhÃ³m Pod cháº¡y **backend** (xá»­ lÃ½ logic).
- Má»™t nhÃ³m Pod cháº¡y cÆ¡ sá»Ÿ dá»¯ liá»‡u (vÃ­ dá»¥: **database**, Redis).

**CÃ¢u há»i Ä‘áº·t ra lÃ :** LÃ m tháº¿ nÃ o Ä‘á»ƒ cÃ¡c Pod frontend cÃ³ thá»ƒ nÃ³i chuyá»‡n má»™t cÃ¡ch á»•n Ä‘á»‹nh vÃ  Ä‘Ã¡ng tin cáº­y vá»›i cÃ¡c Pod backend, khi mÃ  Ä‘á»‹a chá»‰ IP cá»§a cÃ¡c Pod backend cÃ³ thá»ƒ thay Ä‘á»•i liÃªn tá»¥c?

---

### 2\. `ClusterIP` Service - "Tá»•ng Ä‘Ã i ná»™i bá»™" cá»§a Kubernetes â˜ï¸

**`ClusterIP`** chÃ­nh lÃ  giáº£i phÃ¡p cho váº¥n Ä‘á» nÃ y.

- **NÃ³ lÃ  gÃ¬?** ÄÃ¢y lÃ  loáº¡i Service **máº·c Ä‘á»‹nh** trong Kubernetes. Khi báº¡n táº¡o má»™t Service mÃ  khÃ´ng chá»‰ Ä‘á»‹nh `type`, nÃ³ sáº½ tá»± Ä‘á»™ng lÃ  `ClusterIP`.
- **NÃ³ lÃ m gÃ¬?** NÃ³ sáº½ táº¡o ra má»™t **Ä‘á»‹a chá»‰ IP áº£o (gá»i lÃ  ClusterIP)** vÃ  má»™t **tÃªn DNS á»•n Ä‘á»‹nh**, chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p tá»« **bÃªn trong cá»¥m Kubernetes**.
- **Lá»£i Ã­ch:**
  - CÃ¡c Pod khÃ¡c (vÃ­ dá»¥: frontend) cÃ³ thá»ƒ giao tiáº¿p vá»›i má»™t nhÃ³m Pod (vÃ­ dá»¥: backend) thÃ´ng qua má»™t "Ä‘á»‹a chá»‰" duy nháº¥t vÃ  khÃ´ng Ä‘á»•i nÃ y.
  - NÃ³ hoáº¡t Ä‘á»™ng nhÆ° má»™t bá»™ cÃ¢n báº±ng táº£i ná»™i bá»™, tá»± Ä‘á»™ng phÃ¢n phá»‘i cÃ¡c yÃªu cáº§u Ä‘áº¿n má»™t trong cÃ¡c Pod backend má»™t cÃ¡ch ngáº«u nhiÃªn.
  - GiÃºp táº¡o ra cÃ¡c kiáº¿n trÃºc microservices dÃ©couple (Ã­t phá»¥ thuá»™c) vÃ  linh hoáº¡t.

---

### 3\. "Giáº£i pháº«u" má»™t file YAML cá»§a `ClusterIP` Service ğŸ§¬

Viá»‡c táº¡o má»™t `ClusterIP` Service ráº¥t Ä‘Æ¡n giáº£n.

```yaml
apiVersion: v1
kind: Service
metadata:
  name: backend-service # TÃªn cá»§a Service
spec:
  # type: ClusterIP     # ÄÃ¢y lÃ  loáº¡i máº·c Ä‘á»‹nh, nÃªn cÃ³ thá»ƒ bá» qua
  ports:
    - port: 80 # Port mÃ  Service sáº½ láº¯ng nghe
      targetPort: 80 # Port trÃªn cÃ¡c Pod Ä‘Ã­ch
  selector:
    app: my-backend # TÃ¬m táº¥t cáº£ cÃ¡c Pod cÃ³ label nÃ y
```

**Giáº£i thÃ­ch cÃ¡c pháº§n trong `spec`:**

- **`type: ClusterIP`**: Báº¡n cÃ³ thá»ƒ ghi tÆ°á»ng minh, nhÆ°ng náº¿u bá» trá»‘ng trÆ°á»ng `type`, Kubernetes sáº½ tá»± hiá»ƒu Ä‘Ã¢y lÃ  `ClusterIP`.
- **`ports`**:
  - `port`: Port mÃ  Service nÃ y sáº½ má»Ÿ trÃªn Ä‘á»‹a chá»‰ ClusterIP cá»§a nÃ³.
  - `targetPort`: Port mÃ  cÃ¡c container trong Pod Ä‘Ã­ch Ä‘ang láº¯ng nghe.
- **`selector`**: Máº¥u chá»‘t cá»§a váº¥n Ä‘á»\! NÃ³ nÃ³i cho Service biáº¿t: "HÃ£y tÃ¬m vÃ  chuyá»ƒn traffic Ä‘áº¿n táº¥t cáº£ cÃ¡c Pod cÃ³ nhÃ£n lÃ  `app: my-backend`".

---

### 4\. CÃ¡ch sá»­ dá»¥ng

Sau khi Service `backend-service` Ä‘Æ°á»£c táº¡o, cÃ¡c Pod frontend trong cÃ¹ng cá»¥m cÃ³ thá»ƒ dá»… dÃ ng truy cáº­p vÃ o cÃ¡c Pod backend báº±ng cÃ¡ch sá»­ dá»¥ng tÃªn DNS cá»§a Service:

`http://backend-service`

Kubernetes sáº½ tá»± Ä‘á»™ng phÃ¢n giáº£i tÃªn nÃ y thÃ nh Ä‘á»‹a chá»‰ ClusterIP tÆ°Æ¡ng á»©ng vÃ  chuyá»ƒn yÃªu cáº§u Ä‘áº¿n má»™t trong cÃ¡c Pod backend khá»e máº¡nh.

---

### 5\. "Chá»‘t háº¡" cho Ká»³ thi CKA ğŸ“

- `ClusterIP` lÃ  loáº¡i Service **máº·c Ä‘á»‹nh** trong Kubernetes.
- NÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng cho viá»‡c **giao tiáº¿p bÃªn trong cá»¥m (internal communication)**, vÃ­ dá»¥: giá»¯a frontend vÃ  backend.
- NÃ³ **KHÃ”NG** thá»ƒ Ä‘Æ°á»£c truy cáº­p tá»« bÃªn ngoÃ i cá»¥m.
- NÃ³ sá»­ dá»¥ng **`selector`** Ä‘á»ƒ tÃ¬m cÃ¡c Pod mÃ  nÃ³ sáº½ quáº£n lÃ½ vÃ  chuyá»ƒn traffic Ä‘áº¿n.
