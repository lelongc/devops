## 1. `kube-api-server` - "Cá»•ng Giao tiáº¿p" ChÃ­nh cá»§a Kubernetes ğŸšª

![1750673160458](image/05.kube-api-server/1750673160458.png)

`kube-api-server` lÃ  thÃ nh pháº§n quáº£n lÃ½ chÃ­nh vÃ  lÃ  **"cá»•ng vÃ o" duy nháº¥t** cá»§a cá»¥m Kubernetes. Má»i tÆ°Æ¡ng tÃ¡c, tá»« ngÆ°á»i dÃ¹ng cho Ä‘áº¿n cÃ¡c thÃ nh pháº§n khÃ¡c trong cá»¥m, Ä‘á»u pháº£i Ä‘i qua nÃ³.

- Khi báº¡n cháº¡y má»™t lá»‡nh `kubectl`, thá»±c cháº¥t `kubectl` Ä‘ang gá»­i má»™t yÃªu cáº§u Ä‘áº¿n `kube-api-server`.
- Báº¡n cÅ©ng cÃ³ thá»ƒ gá»i trá»±c tiáº¿p API cá»§a nÃ³ mÃ  khÃ´ng cáº§n `kubectl`. dÃ¹ng curl post

---

## 2. Luá»“ng Hoáº¡t Ä‘á»™ng cá»§a `kube-api-server`

Äá»ƒ hiá»ƒu rÃµ vai trÃ² trung tÃ¢m cá»§a nÃ³, hÃ£y xem qua hai luá»“ng hoáº¡t Ä‘á»™ng chÃ­nh:

### a. Khi báº¡n Ä‘á»c dá»¯ liá»‡u (vÃ­ dá»¥: `kubectl get pods`)

1. Lá»‡nh `kubectl` Ä‘Æ°á»£c gá»­i Ä‘áº¿n `kube-api-server`.
2. `api-server` **xÃ¡c thá»±c (authenticates)** vÃ  **kiá»ƒm tra tÃ­nh há»£p lá»‡ (validates)** cá»§a yÃªu cáº§u.
3. `api-server` truy xuáº¥t dá»¯ liá»‡u tá»« kho lÆ°u trá»¯ **`etcd`**.
4. `api-server` tráº£ káº¿t quáº£ vá» cho `kubectl`.

### b. Khi báº¡n thay Ä‘á»•i cá»¥m (vÃ­ dá»¥: táº¡o má»™t Pod má»›i)

ÄÃ¢y lÃ  lÃºc vai trÃ² "nháº¡c trÆ°á»Ÿng" cá»§a `api-server` thá»ƒ hiá»‡n rÃµ nháº¥t:

1. YÃªu cáº§u táº¡o Pod Ä‘Æ°á»£c gá»­i Ä‘áº¿n `api-server`.
2. `api-server` **xÃ¡c thá»±c** vÃ  **kiá»ƒm tra tÃ­nh há»£p lá»‡**.
3. `api-server` táº¡o má»™t Ä‘á»‘i tÆ°á»£ng Pod (chÆ°a Ä‘Æ°á»£c gÃ¡n cho Node nÃ o) vÃ  **cáº­p nháº­t thÃ´ng tin nÃ y vÃ o `etcd`**. NÃ³ bÃ¡o láº¡i cho ngÆ°á»i dÃ¹ng ráº±ng Pod Ä‘Ã£ Ä‘Æ°á»£c táº¡o.
4. **`kube-scheduler`**, vá»‘n luÃ´n "láº¯ng nghe" `api-server`, phÃ¡t hiá»‡n ra cÃ³ Pod má»›i chÆ°a Ä‘Æ°á»£c Ä‘iá»u phá»‘i.
5. `scheduler` tÃ¬m má»™t Node phÃ¹ há»£p vÃ  **bÃ¡o láº¡i cho `api-server`**.
6. `api-server` **cáº­p nháº­t thÃ´ng tin Node Ä‘Æ°á»£c gÃ¡n vÃ o `etcd`**.
7. `api-server` **truyá»n thÃ´ng tin nÃ y Ä‘áº¿n `kubelet`** trÃªn Worker Node tÆ°Æ¡ng á»©ng.
8. `kubelet` nháº­n lá»‡nh, táº¡o Pod trÃªn Node cá»§a mÃ¬nh (báº±ng cÃ¡ch ra lá»‡nh cho Container Runtime Engine) vÃ  **cáº­p nháº­t tráº¡ng thÃ¡i cá»§a Pod vá» láº¡i cho `api-server`**.
9. `api-server` má»™t láº§n ná»¯a **cáº­p nháº­t tráº¡ng thÃ¡i cuá»‘i cÃ¹ng nÃ y vÃ o `etcd`**.

> Qua luá»“ng trÃªn, báº¡n cÃ³ thá»ƒ tháº¥y `api-server` Ä‘á»©ng á»Ÿ trung tÃ¢m cá»§a má»i hoáº¡t Ä‘á»™ng, Ä‘iá»u phá»‘i táº¥t cáº£ cÃ¡c thÃ nh pháº§n khÃ¡c.

---

## 3. TrÃ¡ch nhiá»‡m Cá»‘t lÃµi

- **XÃ¡c thá»±c** vÃ  **kiá»ƒm tra tÃ­nh há»£p lá»‡** cá»§a má»i yÃªu cáº§u.
- **Truy xuáº¥t** vÃ  **cáº­p nháº­t** dá»¯ liá»‡u trong `etcd`.
- **Äiá»ƒm quan trá»ng nháº¥t:** `kube-api-server` lÃ  **thÃ nh pháº§n DUY NHáº¤T** Ä‘Æ°á»£c phÃ©p tÆ°Æ¡ng tÃ¡c trá»±c tiáº¿p vá»›i kho dá»¯ liá»‡u `etcd`. Táº¥t cáº£ cÃ¡c thÃ nh pháº§n khÃ¡c (`scheduler`, `controller-manager`, `kubelet`) Ä‘á»u pháº£i thÃ´ng qua `api-server`.

---

## 4. CÃ¡ch `kube-api-server` Ä‘Æ°á»£c triá»ƒn khai

- **"Thá»§ cÃ´ng" (From Scratch):** Báº¡n sáº½ táº£i file binary cá»§a `kube-api-server` vÃ  cáº¥u hÃ¬nh nÃ³ cháº¡y nhÆ° má»™t service trÃªn Master Node (vÃ­ dá»¥: file service táº¡i `/etc/systemd/system/kube-apiserver.service`).
- **DÃ¹ng `kubeadm`:** `kubeadm` sáº½ triá»ƒn khai `kube-api-server` dÆ°á»›i dáº¡ng má»™t **static Pod** trong namespace **`kube-system`**. File Ä‘á»‹nh nghÄ©a cá»§a Pod nÃ y náº±m táº¡i `/etc/kubernetes/manifests/`.

---

## 5. Xem cÃ¡c TÃ¹y chá»n Cáº¥u hÃ¬nh

`kube-api-server` cÃ³ ráº¥t nhiá»u tÃ¹y chá»n (flag) khi khá»Ÿi cháº¡y.

- Má»™t tÃ¹y chá»n cá»±c ká»³ quan trá»ng lÃ  **`--etcd-servers`**. NÃ³ chá»‰ cho `api-server` biáº¿t Ä‘á»‹a chá»‰ cá»§a `etcd` cluster Ä‘á»ƒ káº¿t ná»‘i.
- **CÃ¡ch xem cÃ¡c tÃ¹y chá»n Ä‘ang cháº¡y:**
  - Vá»›i cá»¥m `kubeadm`: Xem file manifest cá»§a Pod `kube-api-server` táº¡i `/etc/kubernetes/manifests/`.
  - Vá»›i cá»¥m cÃ i thá»§ cÃ´ng: Xem file service táº¡i `/etc/systemd/system/`.
  - CÃ¡ch chung: Liá»‡t kÃª cÃ¡c tiáº¿n trÃ¬nh Ä‘ang cháº¡y trÃªn Master Node vÃ  tÃ¬m `kube-api-server` (vÃ­ dá»¥: `ps aux | grep kube-apiserver`).

---

## 6. "Chá»‘t háº¡" cho Ká»³ thi CKA ğŸ“

- `kube-api-server` lÃ  **trung tÃ¢m Ä‘iá»u phá»‘i**, lÃ  **cá»•ng vÃ o** cá»§a cá»¥m Kubernetes.
- NÃ³ lÃ  thÃ nh pháº§n **duy nháº¥t Ä‘Æ°á»£c nÃ³i chuyá»‡n trá»±c tiáº¿p vá»›i `etcd`**.
- Hiá»ƒu rÃµ vai trÃ² cá»§a nÃ³ trong **vÃ²ng Ä‘á»i táº¡o Pod** lÃ  ráº¥t quan trá»ng.
- Biáº¿t cÃ¡ch tÃ¬m file cáº¥u hÃ¬nh cá»§a `api-server` trong má»™t cá»¥m Ä‘Æ°á»£c dá»±ng báº±ng `kubeadm` (nÃ³ lÃ  má»™t **static Pod**).
