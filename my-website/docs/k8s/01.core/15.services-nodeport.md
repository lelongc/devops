### 1\. BÃ i toÃ¡n: LÃ m sao Ä‘á»ƒ "Tháº¿ giá»›i bÃªn ngoÃ i" nÃ³i chuyá»‡n vá»›i Pod? ğŸŒ

ChÃºng ta Ä‘Ã£ biáº¿t Pod lÃ  nÆ¡i cháº¡y á»©ng dá»¥ng, nhÆ°ng Pod cÃ³ nhá»¯ng váº¥n Ä‘á»:

- NÃ³ cÃ³ Ä‘á»‹a chá»‰ IP ná»™i bá»™, khÃ´ng thá»ƒ truy cáº­p trá»±c tiáº¿p tá»« bÃªn ngoÃ i cá»¥m.
- IP cá»§a Pod khÃ´ng á»•n Ä‘á»‹nh, nÃ³ sáº½ thay Ä‘á»•i náº¿u Pod Ä‘Æ°á»£c táº¡o láº¡i.

Váº­y lÃ m sao Ä‘á»ƒ ngÆ°á»i dÃ¹ng bÃªn ngoÃ i cÃ³ thá»ƒ truy cáº­p vÃ o á»©ng dá»¥ng Ä‘ang cháº¡y trong Pod? Hoáº·c lÃ m sao Ä‘á»ƒ cÃ¡c Pod frontend cÃ³ thá»ƒ nÃ³i chuyá»‡n á»•n Ä‘á»‹nh vá»›i cÃ¡c Pod backend? **Service** chÃ­nh lÃ  cÃ¢u tráº£ lá»i.

![1751438212406](image/15.services-nodeport/1751438212406.png)

---

### 2\. Giá»›i thiá»‡u cÃ¡c loáº¡i "Dá»‹ch vá»¥" (Services)

Kubernetes cung cáº¥p má»™t vÃ i loáº¡i Service chÃ­nh:

![1751438354643](image/15.services-nodeport/1751438354643.png)

1. **`NodePort`**: "Má»Ÿ má»™t cá»•ng" trÃªn má»—i Node trong cá»¥m Ä‘á»ƒ tháº¿ giá»›i bÃªn ngoÃ i cÃ³ thá»ƒ truy cáº­p vÃ o á»©ng dá»¥ng. (ChÃºng ta sáº½ táº­p trung vÃ o loáº¡i nÃ y trong bÃ i hÃ´m nay).

   ![1751438252766](image/15.services-nodeport/1751438252766.png)

2. **`ClusterIP`**: Táº¡o ra má»™t IP "áº£o" chá»‰ cÃ³ thá»ƒ truy cáº­p Ä‘Æ°á»£c tá»« bÃªn trong cá»¥m. DÃ¹ng cho viá»‡c giao tiáº¿p giá»¯a cÃ¡c Pod vá»›i nhau (vÃ­ dá»¥: frontend gá»i backend).
3. **`LoadBalancer`**: Táº¡o ra má»™t bá»™ cÃ¢n báº±ng táº£i (Load Balancer) cá»§a nhÃ  cung cáº¥p dá»‹ch vá»¥ Ä‘Ã¡m mÃ¢y (nhÆ° AWS, Google Cloud) Ä‘á»ƒ phÃ¢n phá»‘i traffic tá»« internet vÃ o á»©ng dá»¥ng cá»§a báº¡n.

---

### 3\. "Má»• xáº»" `NodePort` Service ğŸ”

Khi lÃ m viá»‡c vá»›i `NodePort`, cÃ³ 3 loáº¡i port báº¡n cáº§n phÃ¢n biá»‡t rÃµ:

![1751438381920](image/15.services-nodeport/1751438381920.png)

- **`targetPort`**: ÄÃ¢y lÃ  port mÃ  container cá»§a báº¡n Ä‘ang thá»±c sá»± láº¯ng nghe bÃªn trong **Pod**. VÃ­ dá»¥: web server cá»§a báº¡n cháº¡y á»Ÿ port `80`.
- **`port`**: ÄÃ¢y lÃ  port Ä‘Æ°á»£c má»Ÿ trÃªn chÃ­nh cÃ¡i **Service** (trÃªn Ä‘á»‹a chá»‰ IP áº£o ClusterIP cá»§a nÃ³).
- **`nodePort`**: ÄÃ¢y lÃ  port Ä‘Æ°á»£c má»Ÿ trÃªn **má»—i Worker Node**. NgÆ°á»i dÃ¹ng bÃªn ngoÃ i sáº½ truy cáº­p á»©ng dá»¥ng cá»§a báº¡n qua Ä‘á»‹a chá»‰ `<IP-cá»§a-Node>:<nodePort>`.
  - _LÆ°u Ã½:_ `nodePort` chá»‰ cÃ³ thá»ƒ náº±m trong má»™t dáº£i nháº¥t Ä‘á»‹nh, máº·c Ä‘á»‹nh lÃ  **30000 - 32767**.

---

### 4\. Táº¡o `NodePort` Service báº±ng YAML

Äá»ƒ táº¡o má»™t Service, chÃºng ta cÅ©ng dÃ¹ng file YAML. Cáº¥u trÃºc cá»§a nÃ³ nhÆ° sau:

```yaml
apiVersion: v1
kind: Service
metadata:
  name: myapp-service
spec:
  type: NodePort # 1. Khai bÃ¡o loáº¡i Service lÃ  NodePort

  ports:
    - port: 80 # 2. Port trÃªn chÃ­nh Service
      targetPort: 80 # 3. Port trÃªn Pod mÃ  Service sáº½ trá» tá»›i
      nodePort: 30008 # 4. Port trÃªn Node Ä‘á»ƒ bÃªn ngoÃ i truy cáº­p

  selector: # 5. Máº¥u chá»‘t: Káº¿t ná»‘i Service vá»›i Pod!
    app: myapp
```

**Giáº£i thÃ­ch cÃ¡c pháº§n trong `spec`:**

1. **`type: NodePort`**: Chá»‰ Ä‘á»‹nh rÃµ Ä‘Ã¢y lÃ  má»™t NodePort Service.
2. **`port`**: Port trÃªn Service. ÄÃ¢y lÃ  trÆ°á»ng báº¯t buá»™c.
3. **`targetPort`**: Port trÃªn Pod Ä‘Ã­ch. Náº¿u khÃ´ng khai bÃ¡o, nÃ³ sáº½ máº·c Ä‘á»‹nh báº±ng giÃ¡ trá»‹ cá»§a `port`.
4. **`nodePort`**: Port trÃªn Node. Náº¿u khÃ´ng khai bÃ¡o, Kubernetes sáº½ tá»± chá»n má»™t port trá»‘ng trong dáº£i cho phÃ©p.
5. **`selector`**: ÄÃ¢y lÃ  pháº§n **QUAN TRá»ŒNG NHáº¤T**. NÃ³ nÃ³i cho Service biáº¿t: "HÃ£y tÃ¬m táº¥t cáº£ cÃ¡c Pod nÃ o cÃ³ nhÃ£n (label) lÃ  `app: myapp` vÃ  chuyá»ƒn traffic Ä‘áº¿n cho chÃºng". CÆ¡ cháº¿ **labels vÃ  selectors** nÃ y chÃ­nh lÃ  cáº§u ná»‘i giá»¯a Service vÃ  Pods.

---

### 5\. Service vÃ  "SiÃªu nÄƒng lá»±c" Load Balancing âš–ï¸

- Náº¿u `selector` cá»§a Service khá»›p vá»›i **nhiá»u Pod** (vÃ­ dá»¥: báº¡n cÃ³ 3 Pod frontend cÃ¹ng cÃ³ label `app: myapp`), Service sáº½ tá»± Ä‘á»™ng hoáº¡t Ä‘á»™ng nhÆ° má»™t bá»™ cÃ¢n báº±ng táº£i.
- NÃ³ sáº½ phÃ¢n phá»‘i traffic Ä‘áº¿n cÃ¡c Pod nÃ y má»™t cÃ¡ch ngáº«u nhiÃªn (random algorithm). Báº¡n khÃ´ng cáº§n pháº£i lÃ m gÃ¬ thÃªm\!

  ![1751438481742](image/15.services-nodeport/1751438481742.png)

---

### 6\. Service trÃªn nhiá»u Node

![1751438544446](image/15.services-nodeport/1751438544446.png)

- Khi báº¡n táº¡o má»™t `NodePort` Service, Kubernetes sáº½ tá»± Ä‘á»™ng má»Ÿ cÃ¹ng má»™t `nodePort` Ä‘Ã³ **trÃªn Táº¤T Cáº¢ cÃ¡c Node** trong cá»¥m.
- Äiá»u nÃ y cÃ³ nghÄ©a lÃ  báº¡n cÃ³ thá»ƒ truy cáº­p á»©ng dá»¥ng cá»§a mÃ¬nh báº±ng cÃ¡ch dÃ¹ng IP cá»§a **báº¥t ká»³ Node nÃ o** trong cá»¥m, káº¿t há»£p vá»›i `nodePort` Ä‘Ã³.

---

### 7\. "Chá»‘t háº¡" cho Ká»³ thi CKA ğŸ“

- **Service** lÃ  Ä‘á»‘i tÆ°á»£ng dÃ¹ng Ä‘á»ƒ táº¡o ra má»™t Ä‘iá»ƒm truy cáº­p (endpoint) á»•n Ä‘á»‹nh cho cÃ¡c Pod.
- **`NodePort`** lÃ  loáº¡i Service dÃ¹ng Ä‘á»ƒ "má»Ÿ cá»•ng" trÃªn Node, cho phÃ©p truy cáº­p tá»« bÃªn ngoÃ i.
- Sá»± káº¿t ná»‘i giá»¯a Service vÃ  Pod Ä‘Æ°á»£c thá»±c hiá»‡n thÃ´ng qua **labels vÃ  selectors**. ÄÃ¢y lÃ  cÆ¡ cháº¿ ná»n táº£ng cá»§a Kubernetes.
- Má»™t Service cÃ³ thá»ƒ tá»± Ä‘á»™ng **cÃ¢n báº±ng táº£i** cho nhiá»u Pod.
- Má»™t `NodePort` Service sáº½ cÃ³ hiá»‡u lá»±c trÃªn **táº¥t cáº£ cÃ¡c Node** trong cá»¥m.
