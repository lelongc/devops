### 1. BÃ­ máº­t náº±m á»Ÿ "Cuá»™c so sÃ¡nh Ba bÃªn" ğŸ•µï¸â€â™‚ï¸

Sá»± "thÃ´ng minh" cá»§a `kubectl apply` khÃ´ng pháº£i lÃ  ma thuáº­t, mÃ  lÃ  má»™t quy trÃ¬nh so sÃ¡nh ráº¥t logic dá»±a trÃªn **3 nguá»“n thÃ´ng tin**:

1. **File Cáº¥u hÃ¬nh Cá»¥c bá»™ (Local File):**

   - ÄÃ¢y lÃ  file YAML trÃªn mÃ¡y cá»§a báº¡n, Ä‘á»‹nh nghÄ©a **tráº¡ng thÃ¡i báº¡n mong muá»‘n**.

2. **Cáº¥u hÃ¬nh "Sá»‘ng" (Live Configuration):**

   - ÄÃ¢y lÃ  tráº¡ng thÃ¡i **hiá»‡n táº¡i** cá»§a object Ä‘ang cháº¡y trÃªn cá»¥m Kubernetes (Ä‘Æ°á»£c lÆ°u trong `etcd`).

3. **Cáº¥u hÃ¬nh Ä‘Ã£ Ã¡p dá»¥ng láº§n cuá»‘i (Last Applied Configuration):**

   - ÄÃ¢y lÃ  má»™t "áº£nh chá»¥p" cá»§a file YAML tá»« **láº§n cuá»‘i cÃ¹ng báº¡n cháº¡y `kubectl apply`**. NÃ³ Ä‘Æ°á»£c lÆ°u láº¡i Ä‘á»ƒ tham chiáº¿u.

`kubectl apply` sáº½ nhÃ¬n vÃ o cáº£ ba nguá»“n nÃ y Ä‘á»ƒ quyáº¿t Ä‘á»‹nh pháº£i lÃ m gÃ¬.

---

### 2. Luá»“ng hoáº¡t Ä‘á»™ng cá»§a `apply`

#### a. Khi cháº¡y `apply` láº§n Ä‘áº§u (Táº¡o má»›i)

1. Báº¡n cháº¡y `kubectl apply -f my-pod.yaml`.
2. `apply` tháº¥y object nÃ y chÆ°a tá»“n táº¡i, nÃ³ sáº½ **táº¡o má»›i** object Ä‘Ã³ trÃªn cá»¥m.
3. **BÆ°á»›c Ä‘áº·c biá»‡t:** Sau khi táº¡o, `apply` sáº½ láº¥y ná»™i dung file `my-pod.yaml` cá»§a báº¡n, chuyá»ƒn nÃ³ sang Ä‘á»‹nh dáº¡ng JSON vÃ  **lÆ°u nÃ³ nhÆ° má»™t `annotation`** ngay trÃªn object vá»«a táº¡o. CÃ¡i `annotation` nÃ y chÃ­nh lÃ  "Last Applied Configuration".

#### b. Khi cháº¡y `apply` Ä‘á»ƒ cáº­p nháº­t hoáº·c xÃ³a má»™t trÆ°á»ng

1. Báº¡n chá»‰nh sá»­a file YAML cá»¥c bá»™ cá»§a mÃ¬nh (vÃ­ dá»¥: Ä‘á»•i `image` hoáº·c xÃ³a má»™t `label`).
2. Báº¡n cháº¡y láº¡i `kubectl apply -f my-pod.yaml`.
3. `apply` báº¯t Ä‘áº§u so sÃ¡nh:
   - **Äá»ƒ cáº­p nháº­t má»™t trÆ°á»ng:** NÃ³ so sÃ¡nh file local cá»§a báº¡n vá»›i cáº¥u hÃ¬nh "sá»‘ng". Tháº¥y cÃ³ sá»± khÃ¡c biá»‡t, nÃ³ sáº½ cáº­p nháº­t cáº¥u hÃ¬nh "sá»‘ng".
   - **Äá»ƒ XÃ“A má»™t trÆ°á»ng (ÄÃ¢y lÃ  lÃºc "Last Applied Configuration" tá»a sÃ¡ng âœ¨):**
     - `apply` tháº¥y trÆ°á»ng Ä‘Ã³ Ä‘Ã£ biáº¿n máº¥t khá»i file local cá»§a báº¡n.
     - NÃ³ sáº½ nhÃ¬n vÃ o "Last Applied Configuration" vÃ  tháº¥y: "á»’, láº§n trÆ°á»›c cÃ¡i trÆ°á»ng nÃ y cÃ³ tá»“n táº¡i".
     - Tá»« Ä‘Ã³, nÃ³ suy ra ráº±ng báº¡n Ä‘Ã£ **cá»‘ Ã½ xÃ³a** trÆ°á»ng nÃ y, vÃ  nÃ³ sáº½ tiáº¿n hÃ nh xÃ³a trÆ°á»ng Ä‘Ã³ khá»i cáº¥u hÃ¬nh "sá»‘ng".
4. Sau khi má»i thay Ä‘á»•i hoÃ n táº¥t, `apply` sáº½ láº¡i cáº­p nháº­t `annotation` "Last Applied Configuration" vá»›i ná»™i dung má»›i nháº¥t tá»« file local cá»§a báº¡n.

---

### 3. "Last Applied Configuration" Ä‘Æ°á»£c lÆ°u á»Ÿ Ä‘Ã¢u? ğŸ¤«

- NÃ³ Ä‘Æ°á»£c lÆ°u trá»¯ dÆ°á»›i dáº¡ng má»™t **`annotation`** trÃªn chÃ­nh object Ä‘ang cháº¡y trÃªn cá»¥m.
- TÃªn cá»§a annotation Ä‘Ã³ lÃ : `kubectl.kubernetes.io/last-applied-configuration`.

---

### 4. Lá»i cáº£nh bÃ¡o quan trá»ng: Äá»«ng "Lai cÄƒng"! âš ï¸

- Chá»‰ cÃ³ lá»‡nh `kubectl apply` má»›i táº¡o ra vÃ  sá»­ dá»¥ng `annotation` "Last Applied Configuration".
- CÃ¡c lá»‡nh má»‡nh lá»‡nh nhÆ° `kubectl create` hay `kubectl replace` **hoÃ n toÃ n khÃ´ng quan tÃ¢m** Ä‘áº¿n annotation nÃ y.
- **Do Ä‘Ã³, báº¡n khÃ´ng nÃªn trá»™n láº«n hai phÆ°Æ¡ng phÃ¡p nÃ y trÃªn cÃ¹ng má»™t object.** Náº¿u báº¡n Ä‘Ã£ báº¯t Ä‘áº§u quáº£n lÃ½ má»™t object báº±ng `apply`, hÃ£y luÃ´n dÃ¹ng `apply` cho nÃ³ vá» sau. Náº¿u báº¡n dÃ¹ng `replace` xen vÃ o, `apply` sáº½ bá»‹ "bá»‘i rá»‘i" á»Ÿ láº§n cháº¡y tiáº¿p theo vÃ  cÃ³ thá»ƒ gÃ¢y ra káº¿t quáº£ khÃ´ng mong muá»‘n.

---

### 5. "Chá»‘t háº¡" cho Ká»³ thi CKA ğŸ“

- `kubectl apply` "thÃ´ng minh" vÃ¬ nÃ³ thá»±c hiá»‡n **phÃ©p so sÃ¡nh ba bÃªn** (local, live, last-applied).
- Hiá»ƒu rÃµ vai trÃ² cá»§a `last-applied-configuration` annotation, Ä‘áº·c biá»‡t lÃ  trong viá»‡c **phÃ¡t hiá»‡n cÃ¡c trÆ°á»ng bá»‹ xÃ³a**.
- **KhÃ´ng Ä‘Æ°á»£c trá»™n láº«n** viá»‡c sá»­ dá»¥ng `apply` vá»›i `create`/`replace` trÃªn cÃ¹ng má»™t object. HÃ£y chá»n má»™t trÆ°á»ng phÃ¡i vÃ  theo nÃ³ Ä‘áº¿n cÃ¹ng!
