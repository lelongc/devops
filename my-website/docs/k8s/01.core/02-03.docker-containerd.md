## 1. CÃ¢u chuyá»‡n Lá»‹ch sá»­: Docker, Kubernetes vÃ  sá»± ra Ä‘á»i cá»§a CRI

- **Thuá»Ÿ sÆ¡ khai:** **Docker** lÃ  "vua" cá»§a tháº¿ giá»›i container. **Kubernetes** ban Ä‘áº§u Ä‘Æ°á»£c xÃ¢y dá»±ng Ä‘á»ƒ dÃ n dá»±ng (orchestrate) **chuyÃªn biá»‡t cho Docker**. LÃºc nÃ y, chÃºng "dÃ­nh liá»n" vá»›i nhau.
- **Sá»± trá»—i dáº­y:** Kubernetes ngÃ y cÃ ng phá»• biáº¿n, vÃ  cÃ¡c container runtime khÃ¡c (nhÆ° `rkt`) cÅ©ng muá»‘n Ä‘Æ°á»£c Kubernetes há»— trá»£. Cá»™ng Ä‘á»“ng cáº§n Kubernetes pháº£i lÃ m viá»‡c Ä‘Æ°á»£c vá»›i nhiá»u runtime chá»© khÃ´ng chá»‰ riÃªng Docker.
- **Giáº£i phÃ¡p: CRI (Container Runtime Interface):** Kubernetes giá»›i thiá»‡u **CRI** - má»™t giao diá»‡n chuáº©n. Báº¥t ká»³ container runtime nÃ o tuÃ¢n thá»§ tiÃªu chuáº©n **OCI (Open Container Initiative)** Ä‘á»u cÃ³ thá»ƒ lÃ m viá»‡c vá»›i Kubernetes thÃ´ng qua CRI.

  - _OCI Ä‘á»‹nh nghÄ©a tiÃªu chuáº©n vá» cÃ¡ch build má»™t image (`imagespec`) vÃ  cÃ¡ch má»™t runtime hoáº¡t Ä‘á»™ng (`runtimespec`)._

- **Váº¥n Ä‘á» cá»§a Docker:** Docker ra Ä‘á»i _trÆ°á»›c_ khi cÃ³ CRI, nÃªn nÃ³ khÃ´ng tÆ°Æ¡ng thÃ­ch trá»±c tiáº¿p vá»›i chuáº©n nÃ y.
- **Miáº¿ng vÃ¡ "táº¡m bá»£": `dockershim`:** VÃ¬ Docker quÃ¡ phá»• biáº¿n, Kubernetes Ä‘Ã£ táº¡o ra má»™t "miáº¿ng vÃ¡" tÃªn lÃ  **`dockershim`**. ÄÃ¢y lÃ  má»™t cáº§u ná»‘i táº¡m thá»i Ä‘á»ƒ Kubernetes cÃ³ thá»ƒ tiáº¿p tá»¥c há»— trá»£ Docker engine.
- **Cuá»™c chia ly Ä‘á»‹nh má»‡nh (Kubernetes v1.24):** Viá»‡c duy trÃ¬ `dockershim` ngÃ y cÃ ng trá»Ÿ thÃ nh gÃ¡nh náº·ng. Do Ä‘Ã³, tá»« phiÃªn báº£n **1.24**, Kubernetes Ä‘Ã£ **loáº¡i bá» hoÃ n toÃ n `dockershim`**, Ä‘á»“ng nghÄ©a vá»›i viá»‡c **cháº¥m dá»©t há»— trá»£ trá»±c tiáº¿p Docker engine nhÆ° má»™t container runtime**.

> **LÆ°u Ã½ cá»±c ká»³ quan trá»ng:** CÃ¡c **Docker image** mÃ  báº¡n Ä‘Ã£ build **váº«n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng**! VÃ¬ Docker build image theo chuáº©n OCI `imagespec`, nÃªn cÃ¡c runtime tÆ°Æ¡ng thÃ­ch CRI khÃ¡c (nhÆ° Containerd) váº«n cÃ³ thá»ƒ cháº¡y chÃºng ngon lÃ nh. Chá»‰ cÃ³ _Docker engine_ lÃ  khÃ´ng cÃ²n Ä‘Æ°á»£c há»— trá»£ trá»±c tiáº¿p ná»¯a thÃ´i.

---

## 2. Hiá»ƒu vá» Containerd - "TrÃ¡i tim" cá»§a Docker

- Docker khÃ´ng chá»‰ lÃ  má»™t runtime. NÃ³ lÃ  má»™t bá»™ cÃ´ng cá»¥ bao gá»“m Docker CLI, API, build tools,... vÃ  bÃªn trong nÃ³ chÃ­nh lÃ  **Containerd** - thÃ nh pháº§n cá»‘t lÃµi chá»‹u trÃ¡ch nhiá»‡m cháº¡y container.
- **Containerd** vá»‘n dÄ© Ä‘Ã£ **tÆ°Æ¡ng thÃ­ch vá»›i CRI**. Hiá»‡n nay, nÃ³ Ä‘Ã£ lÃ  má»™t dá»± Ã¡n Ä‘á»™c láº­p, tá»‘t nghiá»‡p táº¡i CNCF. Báº¡n cÃ³ thá»ƒ cÃ i Ä‘áº·t vÃ  sá»­ dá»¥ng riÃªng Containerd mÃ  khÃ´ng cáº§n cÃ i cáº£ bá»™ Docker engine.

---

## 3. "Dá»¥ng cá»¥" trong Ká»· nguyÃªn má»›i: `ctr` vs. `nerdctl` vs. `crictl`

Khi khÃ´ng cÃ²n `docker` trÃªn cÃ¡c node Kubernetes, chÃºng ta sáº½ dÃ¹ng gÃ¬ Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i container? ÄÃ¢y lÃ  3 cÃ´ng cá»¥ báº¡n cáº§n phÃ¢n biá»‡t:

### `ctr`

- **Nguá»“n gá»‘c:** Äi kÃ¨m khi báº¡n cÃ i Ä‘áº·t Containerd.
- **Má»¥c Ä‘Ã­ch:** **Chá»‰ dÃ¹ng Ä‘á»ƒ debug Containerd**. NÃ³ cÃ³ ráº¥t Ã­t tÃ­nh nÄƒng vÃ  khÃ´ng thÃ¢n thiá»‡n vá»›i ngÆ°á»i dÃ¹ng.
- **Káº¿t luáº­n:** Trong thá»±c táº¿, báº¡n gáº§n nhÆ° **sáº½ khÃ´ng dÃ¹ng Ä‘áº¿n nÃ³**. CÃ³ thá»ƒ bá» qua.

### `nerdctl` (Nerd Control)

- **Nguá»“n gá»‘c:** Tá»« cá»™ng Ä‘á»“ng Containerd.
- **Má»¥c Ä‘Ã­ch:** LÃ  má»™t cÃ´ng cá»¥ dÃ²ng lá»‡nh **giá»‘ng há»‡t Docker (Docker-like CLI)** dÃ nh riÃªng cho Containerd. DÃ¹ng cho **má»¥c Ä‘Ã­ch phá»• thÃ´ng** (general purpose).
- **Äiá»ƒm máº¡nh:** CÃº phÃ¡p gáº§n nhÆ° y há»‡t `docker`. Báº¡n chá»‰ cáº§n thay `docker` báº±ng `nerdctl`. VÃ­ dá»¥: `nerdctl run`, `nerdctl ps`, `nerdctl images`. NÃ³ cÃ²n há»— trá»£ cÃ¡c tÃ­nh nÄƒng má»›i hÆ¡n cá»§a Containerd mÃ  Docker chÆ°a cÃ³.
- **Káº¿t luáº­n:** ÄÃ¢y lÃ  cÃ´ng cá»¥ báº¡n nÃªn dÃ¹ng náº¿u muá»‘n cÃ³ tráº£i nghiá»‡m tÆ°Æ¡ng tá»± Docker Ä‘á»ƒ quáº£n lÃ½ container khi chá»‰ cÃ³ Containerd.

### `crictl` (CRI Control)

- **Nguá»“n gá»‘c:** Tá»« **cá»™ng Ä‘á»“ng Kubernetes**.
- **Má»¥c Ä‘Ã­ch:** LÃ  má»™t cÃ´ng cá»¥ dÃ²ng lá»‡nh Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vÃ  **debug Báº¤T Ká»² CRI-compatible runtime nÃ o** (khÃ´ng chá»‰ riÃªng Containerd). ÄÃ¢y lÃ  cÃ´ng cá»¥ nhÃ¬n tá»« "gÃ³c Ä‘á»™ cá»§a Kubernetes".
- **Äiá»ƒm máº¡nh:**
  - Hoáº¡t Ä‘á»™ng trÃªn nhiá»u runtime khÃ¡c nhau.
  - CÃº phÃ¡p cÅ©ng ráº¥t giá»‘ng `docker` cho cÃ¡c lá»‡nh cÆ¡ báº£n (`ps`, `logs`, `exec`, `images`...).
  - NÃ³ "hiá»ƒu" vá» Pod (`crictl pods`), Ä‘iá»u mÃ  Docker khÃ´ng cÃ³.
- **Sá»­ dá»¥ng:**
  - **ÄÃ¢y lÃ  cÃ´ng cá»¥ thay tháº¿ cho `docker` khi báº¡n cáº§n troubleshoot container trÃªn má»™t Kubernetes node**. VÃ­ dá»¥, ngÃ y xÆ°a báº¡n `ssh` vÃ o worker node vÃ  gÃµ `docker ps`, thÃ¬ bÃ¢y giá» báº¡n sáº½ gÃµ `crictl ps`.
  - **LÆ°u Ã½:** `crictl` chá»§ yáº¿u dÃ¹ng Ä‘á»ƒ debug. Báº¡n khÃ´ng nÃªn dÃ¹ng nÃ³ Ä‘á»ƒ táº¡o container thá»§ cÃ´ng, vÃ¬ `kubelet` sáº½ khÃ´ng biáº¿t vá» container Ä‘Ã³ vÃ  cÃ³ thá»ƒ sáº½ xÃ³a nÃ³ Ä‘i.

---

## 4. Báº£ng so sÃ¡nh "Nhanh"

| CÃ´ng cá»¥   | Má»¥c Ä‘Ã­ch                      | Cá»™ng Ä‘á»“ng      | Pháº¡m vi                        |
| :-------- | :---------------------------- | :------------- | :----------------------------- |
| `ctr`     | Debugging                     | Containerd     | Chá»‰ Containerd                 |
| `nerdctl` | **Phá»• thÃ´ng (Giá»‘ng Docker)**  | Containerd     | Chá»‰ Containerd                 |
| `crictl`  | **Debugging (TrÃªn K8s node)** | **Kubernetes** | **Má»i CRI-compatible runtime** |

---

## 5. "Chá»‘t háº¡" cho Ká»³ thi ğŸ“

- Hiá»ƒu rÃµ quÃ¡ trÃ¬nh Kubernetes chuyá»ƒn tá»« phá»¥ thuá»™c `dockershim` sang tháº¿ giá»›i **CRI thuáº§n tÃºy**.
- **Khi nÃ o dÃ¹ng gÃ¬?**
  - **`nerdctl`**: DÃ¹ng khi báº¡n muá»‘n cÃ³ má»™t tráº£i nghiá»‡m **giá»‘ng Docker** Ä‘á»ƒ quáº£n lÃ½ container nÃ³i chung vá»›i Containerd.
  - **`crictl`**: DÃ¹ng khi báº¡n Ä‘ang á»Ÿ **trÃªn má»™t node Kubernetes** vÃ  cáº§n **troubleshoot/debug** cÃ¡c container vÃ  pod. ÄÃ¢y lÃ  cÃ´ng cá»¥ cháº©n Ä‘oÃ¡n chÃ­nh cá»§a báº¡n trÃªn K8s node ngÃ y nay.

## "Docker bá»‹ khai tá»­" trong Kubernetes - Hiá»ƒu sao cho Ä‘Ãºng? ğŸ¤”

ÄÃ¢y lÃ  má»™t Ä‘iá»ƒm gÃ¢y nhiá»u nháº§m láº«n. "Khai tá»­" á»Ÿ Ä‘Ã¢y khÃ´ng cÃ³ nghÄ©a lÃ  Docker Ä‘Ã£ "cháº¿t" hoÃ n toÃ n. NÃ³ chá»‰ cÃ³ nghÄ©a lÃ  Ä‘Ã£ cÃ³ má»™t sá»± thay Ä‘á»•i lá»›n trong cÃ¡ch Kubernetes lÃ m viá»‡c vá»›i container runtime.

### 1. TÃ³m táº¯t láº¡i "Cuá»™c chia ly"

- **Docker khÃ´ng chá»‰ lÃ  má»™t runtime:** Báº¡n cáº§n nhá»› ráº±ng, **Docker** lÃ  má»™t **bá»™ cÃ´ng cá»¥ hoÃ n chá»‰nh**, bao gá»“m:

  - Docker CLI (dÃ²ng lá»‡nh `docker`)
  - API
  - CÃ´ng cá»¥ build image
  - Quáº£n lÃ½ volumes, networking, auth...
  - VÃ  quan trá»ng nháº¥t, bÃªn trong nÃ³ chá»©a thÃ nh pháº§n runtime cá»‘t lÃµi lÃ  **`Containerd`**.

- **`Containerd` má»›i lÃ  thá»© Kubernetes cáº§n:**

  - `Containerd` lÃ  pháº§n chá»‹u trÃ¡ch nhiá»‡m thá»±c thi vÃ  quáº£n lÃ½ vÃ²ng Ä‘á»i cá»§a container.
  - NÃ³ hoÃ n toÃ n tÆ°Æ¡ng thÃ­ch vá»›i **CRI (Container Runtime Interface)** - tiÃªu chuáº©n mÃ  Kubernetes dÃ¹ng Ä‘á»ƒ giao tiáº¿p vá»›i cÃ¡c container runtime.
  - Do Ä‘Ã³, Kubernetes cÃ³ thá»ƒ lÃ m viá»‡c **trá»±c tiáº¿p** vá»›i `Containerd` (hoáº·c cÃ¡c CRI-compatible runtime khÃ¡c).

- **Váº­y táº¡i sao Kubernetes khÃ´ng cáº§n Docker Engine ná»¯a?**

  - Kubernetes Ä‘Ã£ cÃ³ cÆ¡ cháº¿ riÃªng Ä‘á»ƒ quáº£n lÃ½ máº¡ng, volumes, vÃ  cÃ¡c tÃ¡c vá»¥ khÃ¡c. NÃ³ khÃ´ng cáº§n Ä‘áº¿n cÃ¡c cÃ´ng cá»¥ phá»¥ trá»£ Ä‘i kÃ¨m trong bá»™ Docker Engine.
  - Kubernetes chá»‰ cáº§n má»™t thá»© duy nháº¥t tá»« bá»™ Docker: thÃ nh pháº§n runtime. VÃ  vÃ¬ nÃ³ cÃ³ thá»ƒ nÃ³i chuyá»‡n trá»±c tiáº¿p vá»›i `Containerd`, viá»‡c pháº£i Ä‘i qua cáº£ má»™t Docker Engine cá»“ng ká»nh trá»Ÿ nÃªn khÃ´ng cáº§n thiáº¿t vÃ  phá»©c táº¡p (pháº£i thÃ´ng qua `dockershim`).

### 2. Váº­y Docker "cháº¿t" tháº­t hay khÃ´ng? ğŸ‘»

**CÃ¢u tráº£ lá»i dá»©t khoÃ¡t lÃ : KHÃ”NG!** ğŸš«

- **Docker váº«n lÃ  cÃ´ng cá»¥ container phá»• biáº¿n nháº¥t** vÃ  Ä‘Æ°á»£c hÃ ng triá»‡u láº­p trÃ¬nh viÃªn sá»­ dá»¥ng hÃ ng ngÃ y cho viá»‡c **phÃ¡t triá»ƒn cá»¥c bá»™ (local development)** vÃ  **build image**.
- Sá»± thay Ä‘á»•i nÃ y chá»‰ cÃ³ nghÄ©a lÃ : **Kubernetes khÃ´ng cÃ²n yÃªu cáº§u Docker Engine lÃ m container runtime cho nÃ³ ná»¯a.**

### 3. Ãp dá»¥ng trong khÃ³a há»c nÃ y vÃ  thá»±c táº¿

- Trong cÃ¡c bÃ i há»c, viá»‡c tiáº¿p tá»¥c dÃ¹ng **Docker lÃ m vÃ­ dá»¥** Ä‘á»ƒ giáº£ng dáº¡y cÃ¡c khÃ¡i niá»‡m cÆ¡ báº£n vá» container lÃ  **hoÃ n toÃ n á»•n**. NÃ³ giÃºp chÃºng ta hiá»ƒu cÃ¡ch container hoáº¡t Ä‘á»™ng trÆ°á»›c khi Ä‘i vÃ o tháº¿ giá»›i dÃ n dá»±ng phá»©c táº¡p cá»§a Kubernetes.
- **Máº¹o thá»±c hÃ nh:** Náº¿u mÃ¡y báº¡n khÃ´ng cÃ i Docker mÃ  chá»‰ cÃ i `Containerd` riÃªng láº», báº¡n váº«n cÃ³ thá»ƒ lÃ m theo háº§u háº¿t cÃ¡c vÃ­ dá»¥ báº±ng cÃ¡ch thay tháº¿ lá»‡nh `docker` báº±ng lá»‡nh `nerdctl`.

---

## "Chá»‘t háº¡" cho Ká»³ thi ğŸ“

- **"Docker deprecation"** cÃ³ nghÄ©a lÃ  Kubernetes Ä‘Ã£ loáº¡i bá» há»— trá»£ cho **Docker Engine** nhÆ° má»™t _runtime_, khÃ´ng pháº£i lÃ  khai tá»­ Docker nÃ³i chung.
- **Docker images** báº¡n build váº«n **hoáº¡t Ä‘á»™ng 100%** trÃªn Kubernetes vÃ¬ chÃºng tuÃ¢n theo chuáº©n OCI.
- Ká»¹ nÄƒng lÃ m viá»‡c vá»›i Docker (build image, phÃ¡t triá»ƒn á»©ng dá»¥ng trong container) váº«n **cá»±c ká»³ quan trá»ng vÃ  cáº§n thiáº¿t**.
- Trong mÃ´i trÆ°á»ng Kubernetes hiá»‡n Ä‘áº¡i, runtime Ä‘Æ°á»£c sá»­ dá»¥ng trá»±c tiáº¿p lÃ  má»™t runtime tÆ°Æ¡ng thÃ­ch CRI, phá»• biáº¿n nháº¥t chÃ­nh lÃ  **`Containerd`**.
